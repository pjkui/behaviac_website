var jmUtils={version:"1.0.0"};jmUtils.extend=function(t,e){if("function"==typeof e){var r=function(){};r.prototype=e.prototype;var i=t.prototype;i&&i.constructor!=Object&&jmUtils.extend(r,i),t.prototype=new r,t.prototype.constructor=t,t.superClass=e}else{if("object"!=typeof e)throw new Error('fatal error:"Function.prototype.extend" expects a function or object');var n="function"==typeof t?t.prototype:t;for(var o in e)n[o]||(n[o]=e[o]);n._base=e}return t},jmUtils.clone=function(t){if(t&&"object"==typeof t){if(jmUtils.isType(t,jmUtils.list))return new jmUtils.list(t.items);if(jmUtils.isArray(t))return t.slice(0);var e={};e.constructor=t.constructor;for(var r in t)e[r]=jmUtils.clone(t[r]);return e}return t},jmUtils.apply=function(t,e){if("object"==typeof t&&"object"==typeof e)for(var r in t){var i=typeof t[r];"function"!=i&&("object"==i?(e[r]&&"object"==typeof e[r]||(e[r]={}),this.apply(t[r],e[r])):e[r]=t[r])}},jmUtils.list=function(){function t(t){this.items=[],t&&(jmUtils.isArray(t)?this.items=t.slice(0):this.items.push(t))}return t.prototype.add=function(t){if(t&&jmUtils.isArray(t)){for(var e in t)this.add(t[e]);return t}return"object"==typeof t&&this.contain(t)?t:(this.items.push(t),t)},t.prototype.remove=function(t){for(var e=this.items.length-1;e>=0;e--)this.items[e]==t&&this.removeAt(e)},t.prototype.removeAt=function(t){this.items.length>t&&this.items.splice(t,1)},t.prototype.contain=function(t){for(var e in this.items)if(this.items[e]==t)return!0;return!1},t.prototype.get=function(t){if("function"!=typeof t)return this.items[t];for(var e in this.items)if(t(this.items[e]))return this.items[e]},t.prototype.each=function(t,e){if(t&&"function"==typeof t)if(e)for(var r=this.items.length-1;r>=0;r--){var i=t.call(this,r,this.items[r]);if(i===!1)break}else for(var n=this.items.length,r=0;n>r;r++){var i=t.call(this,r,this.items[r]);if(i===!1)break}},t.prototype.sort=function(t){this.items.sort(t)},t.prototype.count=function(t){if(t&&"function"==typeof t){for(var e=0,r=this.items.length,i=0;r>i;i++)t(this.items[i])&&e++;return e}return this.items.length},t.prototype.clear=function(){for(var t=this.items.length-1;t>=0;t--)this.remove(this.items[t])},t}(),jmUtils.cache={items:{},add:function(t,e){return this.set(t,e),e},set:function(t,e){this.items[t]=e},get:function(t){return this.items[t]},remove:function(t){this.items[t]=null}},jmUtils.browser=function(){if(jmUtils.browserInfo)return jmUtils.browserInfo;if(jmUtils.browserInfo={agent:navigator.userAgent},/Mobile/i.test(jmUtils.browserInfo.agent)&&(jmUtils.browserInfo.mobile=!0),/iPad/i.test(jmUtils.browserInfo.agent)?jmUtils.browserInfo.iPad=!0:/iPhone/i.test(jmUtils.browserInfo.agent)?jmUtils.browserInfo.iPhone=!0:/Android/i.test(jmUtils.browserInfo.agent)&&(jmUtils.browserInfo.android=!0),/msie/i.test(jmUtils.browserInfo.agent)){jmUtils.browserInfo.msie=!0;var t=jmUtils.browserInfo.agent.match(/msie\s+\d+(\.\d+)*/i)[0];jmUtils.browserInfo.ver=t.match(/\d+(\.\d+)*/)[0]}else/Chrome/i.test(jmUtils.browserInfo.agent)?jmUtils.browserInfo.chrome=!0:/Safari/i.test(jmUtils.browserInfo.agent)?jmUtils.browserInfo.safari=!0:/Firefox/i.test(jmUtils.browserInfo.agent)&&(jmUtils.browserInfo.firefox=!0);return jmUtils.browserInfo},jmUtils.isSupportedBrowser=function(){var t=jmUtils.browser();return!t.msie||t.ver>8},jmUtils.checkSupportedMode=function(){var t=document.createElement("canvas");if(t&&t.getContext)return"canvas";if(document.createElementNS)return"svg";if(this.browser().msie&&this.browser().ver<9)return"vml";throw"not supported browser"},jmUtils.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},jmUtils.isDate=function(t){return"[object Date]"===Object.prototype.toString.call(t)},jmUtils.loadImg=function(t,e){if(jmUtils.isArray(t)||"object"==typeof t){var r=0,i=0;for(var n in t)r++,e?jmUtils.loadImg(t[n],function(){i++,i==r&&e()}):jmUtils.loadImg(t[n])}else if("string"==typeof t){var o=document.createElement("img");e&&(o.onload=function(){e()},o.onerror=function(){e()}),o.src=t}else e()},jmUtils.require=function(t,e){function r(r){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||e&&e(t)}if(jmUtils.isArray(t)){var i=t.length;for(var n in t)jmUtils.require(t[n],function(t,r){r?e&&e(t,r):(i--,0==i&&e&&e(i))})}else{var o=document.getElementsByTagName("script");for(var n in o)if(o[n].src===t)return void(e&&e(t));o=document.createElement("script"),o.type="text/javascript",o.charset="utf-8",o.src=t;var s=document.getElementsByTagName("head")[0];s.appendChild(o),e&&(o.readyState?o.onreadystatechange=r:o.onload=r),o.onerror=function(){s.removeChild(o),e&&e(t,"load faild")}}},jmUtils.bindEvent=function(t,e,r){if(!e||-1==e.indexOf(" "))return t.attachEvent?t.attachEvent("on"+e,r):t.addEventListener?(t.addEventListener(e,r),!0):!1;for(var i=e.split(" "),n=0;n<i.length;n++)jmUtils.bindEvent(t,i[n],r)},jmUtils.removeEvent=function(t,e,r){return t.removeEventListener?t.removeEventListener(e,r,!1):t.detachEvent?(t.detachEvent("on"+e,r),!0):void(t["on"+e]=null)},jmUtils.getElementPosition=function(t){if(t){var e={top:0,left:0};if(t.offsetParent)for(;t.offsetParent;)e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent;else t.x?e.left+=t.x:t.x&&(e.top+=t.y);return e}},jmUtils.getEventPosition=function(t,e){t=t||event;var r=t.changedTouches||t.targetTouches||t.touches;r&&(t=r[0]);var i=t.pageX||t.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft),n=t.pageY||t.clientY+(document.documentElement.scrollTop||document.body.scrollTop),o=t.offsetX,s=t.offsetY;if("undefined"==typeof o&&"undefined"==typeof s){var a=jmUtils.getElementPosition(t.target||t.srcElement);o=i-a.left,s=n-a.top}return e&&(e.x&&(o/=e.x),e.y&&(s/=e.y)),{pageX:i,pageY:n,clientX:t.clientX,clientY:t.clientY,offsetX:o,offsetY:s,layerX:t.layerX,layerY:t.layerY,screenX:t.screenX,screenY:t.screenY,x:o,y:s}},jmUtils.isType=function(t,e){return t&&"object"==typeof t&&t.constructor===e?!0:!1},jmUtils.pointInPolygon=function(t,e,r){r=r||1,r/=2;var i,n,o=e.length,s=!1,a=!0;if(!e||0==o)return 0;if(1==o)return Math.abs(e[0].x-t.x)<=r&&Math.abs(e[0].y-t.y)<=r;if(2==o){if(Math.min(e[0].x,e[1].x)-t.x>r||t.x-Math.max(e[0].x,e[1].x)>r)return 0;if(Math.min(e[0].y,e[1].y)-t.y>r||t.y-Math.max(e[0].y,e[1].y)>r)return 0;if(e[0].x==e[1].x)return Math.abs(e[0].x-t.x)<=r&&(t.y-e[0].y)*(t.y-e[1].y)<=0?1:0;if(e[0].y==e[1].y)return Math.abs(e[0].y-t.y)<=r&&(t.x-e[0].x)*(t.x-e[1].x)<=0?1:0;if(Math.abs(e[0].x-t.x)<r&&Math.abs(e[0].y-t.y)<r)return 1;if(Math.abs(e[1].x-t.x)<r&&Math.abs(e[1].y-t.y)<r)return 1;if(t.y!=e[0].y&&t.y!=e[1].y){var f=(e[1].x-e[0].x)/(e[1].y-e[0].y)*(t.y-e[0].y),l=(t.y-e[0].y)/Math.sqrt(f*f+(t.y-e[0].y)*(t.y-e[0].y)),m=l*(t.x-e[0].x-f);return Math.abs(m)<=r?1:0}return 0}for(i=0;o>i;++i)if(e[i].x==t.x&&e[i].y==t.y)return 1;for(t=jmUtils.clone(t);a;)for(a=!1,s=!1,i=0,n=o-1;o>i;n=i++)if(e[i].y<t.y&&t.y<e[n].y||e[n].y<t.y&&t.y<e[i].y){if(t.x<=e[i].x||t.x<=e[n].x){var u=(t.y-e[i].y)*(e[n].x-e[i].x)/(e[n].y-e[i].y)+e[i].x;if(t.x<u)s=!s;else if(t.x==u)return 1}}else if(t.y==e[i].y){if(t.x<e[i].x){e[i].y>e[n].y?--t.y:++t.y,a=!0;break}}else if(e[i].y==e[n].y&&t.y==e[i].y&&(e[i].x<t.x&&t.x<e[n].x||e[n].x<t.x&&t.x<e[i].x)){s=!0;break}return s?2:0},jmUtils.checkOutSide=function(t,e,r){var i={left:0,right:0,top:0,bottom:0};return r.x<0?i.left=e.left+r.x-t.left:r.x>0&&(i.right=e.right+r.x-t.right),r.y<0?i.top=e.top+r.y-t.top:r.y>0&&(i.bottom=e.bottom+r.y-t.bottom),i},jmUtils.guid=function(){var t=(new Date).getTime();return t},jmUtils.trimStart=function(t,e){if(e=e||" ",t&&t.length>0){var r=t[0];if(r===e||e.indexOf(r)>=0)return t=t.substring(1),jmUtils.trimStart(t,e)}return t},jmUtils.trimEnd=function(t,e){if(e=e||" ",t&&t.length>0){var r=t[t.length-1];if(r===e||e.indexOf(r)>=0)return t=t.substring(0,t.length-1),jmUtils.trimStart(t,e)}return t},jmUtils.trim=function(t,e){return jmUtils.trimEnd(jmUtils.trimStart(t,e),e)},jmUtils.checkPercent=function(t){return"string"==typeof t&&(t=jmUtils.trim(t),"%"==t[t.length-1])?t:void 0},jmUtils.percentToNumber=function(t){if("string"==typeof t){var e=jmUtils.checkPercent(t);e&&(t=jmUtils.trim(e,"%"),t/=100)}return t},jmUtils.indexOf=function(t,e){if(jmUtils.isArray(e)){for(var r=0;r<e.length;r++)if(e[r]==t)return r}else if("string"==typeof e)return e.indexOf(t);return-1},jmUtils.parseXML=function(t){var e;if(DOMParser){var r=new DOMParser;e=r.parseFromString(t,"text/xml")}else{if(!window.ActiveXObject)return null;e=new ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.loadXML(t)}return e},jmUtils.xmlToJSON=function(t){function e(t,r){if(t&&t.childNodes&&t.childNodes.length>0)for(var i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];if(1==n.nodeType){var o=n.name||n.nodeName||n.tagName;if(o){var s={children:[],attributes:{}};if(n.attributes)for(var a in n.attributes){var f=n.attributes[a],l=f.name||f.nodeName;l&&(s.attributes[l]=jmUtils.trim(f.value||n.nodeValue||f.textContent))}s.name=o,s.value=jmUtils.trim(n.value||n.nodeValue||n.textContent),r.children.push(s),e(n,s)}else r.value=jmUtils.trim(n.value||n.nodeValue||n.textContent),e(n,r)}}}if(!t)return null;"string"==typeof t&&(t=jmUtils.parseXML(t));var r={children:[]};return r.version=t.xmlVersion,r.title=t.title,e(t,r),r},jmUtils.hexToNumber=function(t){if("string"!=typeof t)return t;t=t.toLowerCase();for(var e="0123456789abcdef",r=0,i=t.length,n=i-1;n>=0;n--){var o=Number(e.indexOf(t[n]));if(0!=o){for(var s=i-n,a=1,f=0;s>f;f++)a*=16;r+=o*a}}return r},jmUtils.numberToHex=function(t){for(var e="0123456789abcdef",r="";t>0;){var i=t%16;r=e[i]+r,t=Math.floor(t/16)}return r},jmUtils.toColor=function(t,e,r,i){if("string"==typeof t){if(t.indexOf("rgb")>=0){t=this.trim(t,"rgba()) ");var n=t.split(",");t=n[0],e=n[1],r=n[2],void 0==i&&n.length>3&&(i=n[3])}else t.length<6?(r=t.substring(t.length-1,1),e=t.substring(t.length-2,1),t=t.substring(t.length-3,1),r+=""+r,e+=""+e,t+=""+t,t=this.hexToNumber(t),e=this.hexToNumber(e),r=this.hexToNumber(r)):(r=t.substring(t.length-2,2),e=t.substring(t.length-4,2),t.length>7&&(i=t.substring(t.length-8,2),i=this.hexToNumber(i)/255),t=t.substring(t.length-6,2),t=this.hexToNumber(t),e=this.hexToNumber(e),r=this.hexToNumber(r));return i?"rgba("+t+","+e+","+r+","+i+")":"rgb("+t+","+e+","+r+")"}return t=this.numberToHex(t),t=1==t.length?"0"+t:t,e=this.numberToHex(e),e=1==e.length?"0"+e:e,r=this.numberToHex(r),r=1==r.length?"0"+r:r,"#"+t+e+r},jmUtils.parseDate=function(t){if(jmUtils.isDate(t))return t;if("number"==typeof t)return new Date(t);var e=(t+",0,0,0").match(/\d+/g);return e[5]?new Date(e[0],e[1]-1,e[2],e[3],e[4],e[5]):new Date(t)},jmUtils.formatDate=function(t,e){t=this.parseDate(t||new Date),e=e||"yyyy-MM-dd HH:mm:ss";var r=e.replace("yyyy",t.getFullYear().toString()).replace("MM",(t.getMonth()<9?"0":"")+(t.getMonth()+1).toString()).replace("dd",(t.getDate()<9?"0":"")+t.getDate().toString()).replace("HH",(t.getHours()<9?"0":"")+t.getHours().toString()).replace("mm",(t.getMinutes()<9?"0":"")+t.getMinutes().toString()).replace("ss",(t.getSeconds()<9?"0":"")+t.getSeconds().toString());return r};
function jmObject(){}jmObject.prototype.is=function(t){return"string"==typeof t?this.type==t:this instanceof t},jmObject.prototype.animate=function(t,e){if(this.is("jmGraph")){if(t){this.animateHandles||(this.animateHandles=new jmUtils.list);var a=[];if(arguments.length>2)for(var i=2;i<arguments.length;i++)a.push(arguments[i]);this.animateHandles.add({millisec:e||20,handle:t,params:a})}if(this.animateHandles&&this.animateHandles.count()>0){var n=this;this.dispatcher=setTimeout(function(t){t=t||n;var e=!1,a=[],i=(new Date).getTime();t.animateHandles.each(function(n,s){try{if(s&&s.handle&&(!s.times||i-s.times>=s.millisec)){var m=s.handle.apply(t,s.params);m===!1&&a.push(s),s.times=i,e=!0}}catch(r){window.console&&window.console.info&&window.console.info(r.toString()),s&&a.push(s)}});for(var s in a)t.animateHandles.remove(a[s]);e&&t.redraw(),t.animate()},10,this)}}else{var s=this.findParent("jmGraph");s&&s.animate.apply(s,arguments)}};
var jmProperty=function(){this.__properties={},this.__eventHandles={}};jmUtils.extend(jmProperty,jmObject),jmProperty.prototype.getValue=function(e){return this.__properties||(this.__properties={}),this.__properties[e]},jmProperty.prototype.setValue=function(e,t){if("undefined"!=typeof t){this.__properties||(this.__properties={});var r={oldValue:this.getValue(e),newValue:t};this.__properties[e]=t,this.emit("PropertyChange",e,r)}return this.getValue(e)},jmProperty.prototype.on=function(e,t){this.__eventHandles||(this.__eventHandles={});var r=this.__eventHandles[e];r||(r=this.__eventHandles[e]=[]);for(var i in r)if(r[i]===t)return;r.push(t)},jmProperty.prototype.emit=function(e){var t=this.__eventHandles?this.__eventHandles[e]:null;if(t){var r=[],i=arguments.length;if(i>1)for(var n=1;i>n;n++)r.push(arguments[n]);for(var n in t)t[n].apply(this,r)}};
function jmEvents(e,t){function n(e,t){this.container=e,this.target=t||e,this.init=function(){var t=this.target;t.oncontextmenu=function(){return!1},jmUtils.bindEvent(this.target,"mousedown",function(t){t=t||event;e.raiseEvent("mousedown",t);return t.preventDefault&&t.preventDefault(),!1}),jmUtils.bindEvent(window.document,"touchstart",function(t){t=t||event,e.raiseEvent("touchstart",t)}),jmUtils.bindEvent(window.document,"mousemove",function(n){n=n||event;var i=n.target||n.srcElement;if(i==t){{e.raiseEvent("mousemove",n)}return n.preventDefault&&n.preventDefault(),!1}}),jmUtils.bindEvent(window.document,"touchmove",function(t){t=t||event,e.raiseEvent("touchmove",t)}),jmUtils.bindEvent(this.target,"mouseover",function(t){t=t||event,e.raiseEvent("mouseover",t)}),jmUtils.bindEvent(this.target,"mouseleave",function(t){t=t||event,e.raiseEvent("mouseleave",t)}),jmUtils.bindEvent(this.target,"mouseout",function(t){t=t||event,e.raiseEvent("mouseout",t)}),jmUtils.bindEvent(window.document,"mouseup",function(t){t=t||event;var n=e.raiseEvent("mouseup",t);return n===!1?(t.preventDefault&&t.preventDefault(),!1):void 0}),jmUtils.bindEvent(window.document,"touchend",function(t){return t=t||event,e.raiseEvent("touchend",t),!1}),jmUtils.bindEvent(this.target,"dblclick",function(t){t=t||event,e.raiseEvent("dblclick",t)}),jmUtils.bindEvent(this.target,"click",function(t){t=t||event,e.raiseEvent("click",t)}),jmUtils.bindEvent(document,"resize",function(t){return t=t||event,e.raiseEvent("resize",t)})},this.init()}function i(e,t){function n(e){var t=e.srcElement||e.target;return!t||"INPUT"!=t.tagName&&"TEXTAREA"!=t.tagName&&"ANCHOR"!=t.tagName&&"FORM"!=t.tagName&&"FILE"!=t.tagName&&"IMG"!=t.tagName&&"HIDDEN"!=t.tagName&&"RADIO"!=t.tagName&&"TEXT"!=t.tagName?!0:!1}this.container=e,this.target=t||e,this.init=function(){jmUtils.bindEvent(document,"keypress",function(t){if(t=t||event,n(t)){var i=e.raiseEvent("keypress",t);return i===!1&&t.preventDefault&&t.preventDefault(),i}}),jmUtils.bindEvent(document,"keydown",function(t){if(t=t||event,n(t)){var i=e.raiseEvent("keydown",t);return i===!1&&t.preventDefault&&t.preventDefault(),i}}),jmUtils.bindEvent(document,"keyup",function(t){if(t=t||event,n(t)){var i=e.raiseEvent("keyup",t);return i===!1&&t.preventDefault&&t.preventDefault(),i}})},this.init()}this.mouseHandler=new n(e,t),this.keyHandler=new i(e,t)}
function jmSVG(t,e,o){this.paper=new Raphael(t,e,o)}function jmVML(){this.container=this.create("div"),this.container.css("position","relative"),document.namespaces.add("v","urn:schemas-microsoft-com:vml");var t=document.createElement("style");t.type="text/css",t.styleSheet.cssText="v\\:*{behavior:url(#default#VML);}v\\:shape{behavior:url(#default#VML);}v\\:oval{behavior:url(#default#VML);}v\\:fill{behavior:url(#default#VML);}v\\:stroke{behavior:url(#default#VML);}",document.getElementsByTagName("head")[0].appendChild(t)}function jmSVGElement(t,e,o){this.paper=e,this.element=e[t](),this.control=o}jmSVG.prototype.create=function(t,e){var o=new jmSVGElement(t,this.paper,e);return o},jmSVG.prototype.width=function(t){return this.paper.width(t)},jmSVG.prototype.height=function(t){return this.paper.height(t)},jmSVG.prototype.fill=function(){},jmSVG.prototype.stroke=function(){},jmSVG.prototype.closePath=function(){},jmSVG.prototype.beginPath=function(){},jmSVG.prototype.save=function(){},jmSVG.prototype.restore=function(){},jmSVG.prototype.moveTo=function(){},jmSVG.prototype.lineTo=function(){},jmSVG.prototype.arc=function(){},jmSVG.prototype.drawImage=function(){},jmUtils.extend(jmVML,jmSVG),jmVML.prototype.create=function(t){switch(t){case"path":t="v:shape";break;case"circle":t="v:roundrect"}var e=new jmSVGElement(t,"vml");return e},jmSVGElement.prototype.width=function(t){return"undefined"!=typeof t?this.css("width",t+"px"):t=Math.max(this.element.offsetWidth||this.element.clientWidth),Number(t)},jmSVGElement.prototype.height=function(t){return"undefined"!=typeof t?this.css("height",t+"px"):t=Math.max(this.element.offsetHeight||this.element.clientHeight),Number(t)},jmSVGElement.prototype.setStyle=function(t){if("vml"==this.mode){var e=t.parent&&t.parent.absoluteBounds?t.parent.absoluteBounds:t.absoluteBounds;this.css({position:"absolute",left:e.left+"px",top:e.top+"px",width:t.bounds.width+"px",height:t.bounds.height+"px"}),this.attr("fill","transparent"),this.attr("coordsize",Math.floor(100*t.bounds.width)+","+Math.floor(100*t.bounds.height))}},jmSVGElement.prototype.attr=function(t,e,o,n){if(1==arguments.length){if("string"==typeof t){var i=this.element.attr(t);return i?i.content||i||"":""}"object"==typeof t&&this.element.attr(t)}else if(arguments.length>=2){if("path"===t&&jmUtils.isArray(e)){for(var r="M",s="L",l="Z",p=" ",m="",a=r+e[0].x+p+e[0].y,h=e.length,c=1;h>c;c++){var u=e[c];a+=u.m?" "+r+u.x+p+u.y:" "+s+u.x+p+u.y}o&&(a+=" "+l),e=a+" "+m}var f="jm_control_style_mapping_"+this.mode,d=jmUtils.cache.get(f);d||(d={fill:"fill",stroke:"stroke",lineWidth:"stroke-width",fillStyle:"fill",strokeStyle:"stroke",font:"font",path:"path",lineJoin:"lineJoin",lineCap:"lineCap"},jmUtils.cache.set(f,d)),t=d[t]||t,"string"==typeof t&&("object"==typeof e?jmUtils.isType(e,jmGradient)?this.element.attr(t,e.toGradient(this.control)):jmUtils.isType(e,jmShadow)&&(this.glow=this.element.glow(e.toGlow())):"transparent"!=e&&this.element.attr(t,e))}},jmSVGElement.prototype.css=function(t,e){return void this.attr(t,e)},jmSVGElement.prototype.appendTo=function(t){},jmSVGElement.prototype.remove=function(){this.element.remove()},jmSVGElement.prototype.show=function(){this.element.show()},jmSVGElement.prototype.hide=function(){this.element.hide()},jmSVGElement.prototype.bind=function(t,e){},jmSVGElement.prototype.unbind=function(t,e){};
function jmControl(){}function runEventHandle(t,o){var e=this.getEvent(t);if(e){var i=this;e.each(function(t,e){!1===e.call(i,o)&&(o.cancel=!0)})}return o.cancel}jmUtils.extend(jmControl,jmProperty),jmControl.prototype.initializing=function(t,o){this.context=t,this.style=o||{},this.visible=!0;var e=this.mode||(this.mode=this.graph.mode);"canvas"===e||this.svgShape||"jmGraph"===this.type||(this.svgShape=this.context.create("path",this));var i=this;this.children=function(){var t=new jmUtils.list,o=t.add;return t.add=function(t){return"object"==typeof t?(t.parent&&t.parent!=i&&t.parent.children&&t.parent.children.remove(t),t.parent=i,this.contain(t)&&this.oremove(t),o.call(this,t),t.emit("add",t),t):void 0},t.oremove=t.remove,t.remove=function(t){"object"==typeof t&&(t.parent=null,t.remove(!0),this.oremove(t))},t.sort=function(){var e={};t.each(function(t,o){var i=o.zIndex;if(!i&&o.style&&o.style.zIndex&&(i=Number(o.style.zIndex)),i){var n=e[i]||(e[i]=[]);n.push(o)}});for(var i in e)o.call(this,e[i])},t.clear=function(){t.each(function(t,o){this.remove(o)},!0)},t}()},jmControl.prototype.cursor=function(t){if(this.svgShape)this.svgShape.css("cursor",t);else{var o=this.graph||this.findParent("jmGraph");o&&o.css("cursor",t)}},jmControl.prototype.setStyle=function(t){function o(t,e,i,n){var s=e[i];if(s)if(t.mode&&"canvas"!=t.mode)t.svgShape&&t.svgShape.attr(n||i,s);else{var r="jm_control_style_mapping",h=jmUtils.cache.get(r);h||(h={fill:"fillStyle",stroke:"strokeStyle","shadow.blur":"shadowBlur","shadow.x":"shadowOffsetX","shadow.y":"shadowOffsetY","shadow.color":"shadowColor",lineWidth:"lineWidth",fillStyle:"fillStyle",strokeStyle:"strokeStyle",font:"font",opacity:"globalAlpha",textAlign:"textAlign",textBaseline:"textBaseline",shadowBlur:"shadowBlur",shadowOffsetX:"shadowOffsetX",shadowOffsetY:"shadowOffsetY",shadowColor:"shadowColor",lineJoin:"lineJoin",lineCap:"lineCap"},jmUtils.cache.add(r,h));var a=typeof s;if("object"!=a||h[i]){if("object"==a&&jmUtils.isType(s,jmGradient)){var l=h[n||i]||i;t.context[l]=s.toGradient(t)}else if("function"!=a&&"object"!=a){var l=h[n||i];if(l)t.context[l]=s;else switch(i){case"rotate":var c=0,p=0;if(t.rotatePosition){var u=t.parent&&t.parent.absoluteBounds?t.parent.absoluteBounds:t.absoluteBounds;c=t.rotatePosition.x+u.left,p=t.rotatePosition.y+u.top}t.context.translate(c,p),t.context.rotate(s);break;case"transform":jmUtils.isArray(s)?t.context.transform.apply(t.context,s):"object"==typeof s&&t.context.transform(s.scaleX,s.skewX,s.skewY,s.scaleY,s.offsetX,s.offsetY);break;case"translate":t.context.translate(s.x,s.y);break;case"cursor":t.cursor(s)}}}else switch(i){case"shadow":for(var m in s)o(t,s,m,i+"."+m);break;case"translate":t.context.translate(s.x,s.y)}}}if(t=t||this.style){this.translate&&o(this,{translate:this.translate},"translate"),this.transform&&o(this,{transform:this.transform},"transform"),this.rotate&&o(this,{rotate:this.rotate},"rotate");for(var e in t)o(this,t,e)}},jmControl.prototype.getBounds=function(){var t={};if(this.points&&this.points.length>0)for(var o in this.points){var e=this.points[o];("undefined"==typeof t.left||t.left>e.x)&&(t.left=e.x),("undefined"==typeof t.top||t.top>e.y)&&(t.top=e.y),("undefined"==typeof t.right||t.right<e.x)&&(t.right=e.x),("undefined"==typeof t.bottom||t.bottom<e.y)&&(t.bottom=e.y)}else if(this.getLocation){var e=this.getLocation();e&&(t.left=e.left,t.top=e.top,t.right=e.left+e.width,t.bottom=e.top+e.height)}return t.left||(t.left=0),t.top||(t.top=0),t.right||(t.right=0),t.bottom||(t.bottom=0),t.width=t.right-t.left,t.height=t.bottom-t.top,t},jmControl.prototype.getLocation=function(t){if(t!==!0&&this.location)return this.location;var o=this.location={left:0,top:0,width:0,height:0},e=this.position();o.center=this.center&&"function"==typeof this.center?jmUtils.clone(this.center()):null,o.radius=this.radius?this.radius():null,o.width=this.width()||0,o.height=this.height()||0;var i=this.style.margin||{};if(i.left=i.left||0,i.top=i.top||0,i.right=i.right||0,i.bottom=i.bottom||0,e?(o.left=e.x,o.top=e.y):(o.left=i.left,o.top=i.top),!this.parent)return o;var n=this.parent.bounds?this.parent.bounds:this.parent.getBounds();return jmUtils.checkPercent(o.left)&&(o.left=jmUtils.percentToNumber(o.left)*n.width),jmUtils.checkPercent(o.top)&&(o.top=jmUtils.percentToNumber(o.top)*n.height),jmUtils.checkPercent(o.width)&&(o.width=jmUtils.percentToNumber(o.width)*n.width),jmUtils.checkPercent(o.height)&&(o.height=jmUtils.percentToNumber(o.height)*n.height),o.center&&(jmUtils.checkPercent(o.center.x)&&(o.center.x=jmUtils.percentToNumber(o.center.x)*n.width),jmUtils.checkPercent(o.center.y)&&(o.center.y=jmUtils.percentToNumber(o.center.y)*n.height)),o.radius&&jmUtils.checkPercent(o.radius)&&(o.radius=jmUtils.percentToNumber(o.radius)*Math.min(n.width,n.height)),o},jmControl.prototype.remove=function(){this.svgShape&&this.svgShape.remove(),this.parent&&this.parent.children.remove(this)},jmControl.prototype.position=function(t){return this.setValue("position",t)},jmControl.prototype.width=function(t){return this.setValue("width",t)},jmControl.prototype.height=function(t){return this.setValue("height",t)},jmControl.prototype.offset=function(t,o,e){e=e===!1?!1:!0;var i=this.getLocation(!0),n=!1;if(this.center&&"function"==typeof this.center){var s=this.center();s&&(s.x=i.center.x+t,s.y=i.center.y+o,n=!0)}if(0==n&&this.position&&"function"==typeof this.position){var r=this.position();r&&(i.left+=t,i.top+=o,r.x=i.left,r.y=i.top,n=!0)}if(0==n&&this.cpoints&&"function"==typeof this.cpoints){var r=this.cpoints();if(r){for(var h=r.length,a=0;h>a;a++)r[a].x+=t,r[a].y+=o;n=!0}}if(0==n&&this.points){for(var h=this.points.length,a=0;h>a;a++)this.points[a].x+=t,this.points[a].y+=o;n=!0}this.emit("move",{offsetX:t,offsetY:o,trans:e}),this.graph.refresh()},jmControl.prototype.getAbsoluteBounds=function(){var t=this.bounds||this.getBounds();if(this.parent&&this.parent.absoluteBounds){var o=this.parent.absoluteBounds||this.parent.getAbsoluteBounds();return{left:o.left+t.left,top:o.top+t.top,right:o.left+t.right,bottom:o.top+t.bottom,width:t.width,height:t.height}}return t},jmControl.prototype.beginDraw=function(){this.getLocation(!0),this.context.beginPath()},jmControl.prototype.endDraw=function(){this.style.close&&this.context.closePath(),this.style.fill&&this.context.fill(),(this.style.stroke||!this.style.fill)&&this.context.stroke()},jmControl.prototype.draw=function(){if(this.points&&this.points.length>0){var t=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;if(this.mode&&"canvas"!=this.mode){this.svgShape.setStyle(this);for(var o=this.points.slice(0),e=o.length,i=0;e>i;i++)o[i].x+=t.left,o[i].y+=t.top;this.svgShape.attr("path",o,this.style.close)}else{this.context.moveTo(this.points[0].x+t.left,this.points[0].y+t.top);for(var e=this.points.length,i=1;e>i;i++){var n=this.points[i];n.m?this.context.moveTo(n.x+t.left,n.y+t.top):this.context.lineTo(n.x+t.left,n.y+t.top)}}}},jmControl.prototype.paint=function(t){t!==!1&&this.visible!==!1?(this.svgShape&&this.svgShape.show(),this.initPoints&&this.initPoints(),this.bounds=this.getBounds(),this.absoluteBounds=this.getAbsoluteBounds(),this.context.save(),this.svgShape&&this.svgShape.glow&&this.svgShape.glow.remove(),this.setStyle(),this.emit("beginDraw",this),this.beginDraw&&this.beginDraw(),this.draw&&this.draw(),this.endDraw&&this.endDraw(),this.children&&(this.children.sort(),this.children.each(function(t,o){o&&o.paint&&o.paint()})),this.emit("endDraw",this),this.context.restore()):this.svgShape&&(this.svgShape.hide(),this.children&&this.children.each(function(t,o){o&&o.paint&&o.paint(!1)}))},jmControl.prototype.getEvent=function(t){return this.__events?this.__events[t]:null},jmControl.prototype.bind=function(t,o){function e(t,o){return this.__events||(this.__events={}),this.__events[t]=o}var i=this.getEvent(t)||e.call(this,t,new jmUtils.list);i.contain(o)||i.add(o)},jmControl.prototype.unbind=function(t,o){var e=this.getEvent(t);e&&e.remove(o)},jmControl.prototype.checkPoint=function(t){var o=this.bounds||this.getBounds();return t.x>o.right||t.x<o.left?!1:t.y>o.bottom||t.y<o.top?!1:!0},jmControl.prototype.raiseEvent=function(t,o){if(this.visible!==!1){if(!o.position){var e=this.findParent("jmGraph"),i=jmUtils.getEventPosition(o,e.scaleSize);if("canvas"!==this.mode){var n=e.getPosition();i.x=i.offsetX=i.pageX-n.left,i.y=i.offsetY=i.pageY-n.top}var s=o.srcElement||o.target;o={position:i,button:0==o.button?1:o.button,keyCode:o.keyCode||o.charCode||o.which,ctrlKey:o.ctrlKey,cancel:!1,srcElement:s}}this.children&&this.children.each(function(e,i){o.cancel!==!0&&i.raiseEvent(t,o)},!0);var r=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;return r?(o.position.x=o.position.offsetX-r.left,o.position.y=o.position.offsetY-r.top,this.checkPoint(o.position)?(o.target||(o.target=this),o.cancel!==!0&&runEventHandle.call(this,t,o),this.focused||"mousemove"!=t||(this.focused=!0,this.raiseEvent("mouseover",o))):this.focused&&"mousemove"==t&&(this.focused=!1,runEventHandle.call(this,"mouseleave",o)),0==o.cancel):!1}},jmControl.prototype.clearEvents=function(t){var o=this.getEvent(t);o&&o.clear},jmControl.prototype.findParent=function(t){if("string"==typeof t){if(this.type==t)return this}else if(this.is(t))return this;return this.parent?this.parent.findParent(t):null},jmControl.prototype.canMove=function(t,o){if(!this.__mvMonitor){this.__mvMonitor={},this.__mvMonitor.mouseDown=!1,this.__mvMonitor.curposition={x:0,y:0};var e=this;this.__mvMonitor.mv=function(t){var o=e;if(o.__mvMonitor.mouseDown){o.parent.bounds=null;var i=o.parent.getAbsoluteBounds(),n=t.position.x-o.__mvMonitor.curposition.x,s=t.position.y-o.__mvMonitor.curposition.y;if(o.lockSide){var r=o.bounds||o.getAbsoluteBounds(),h=jmUtils.checkOutSide(i,r,{x:n,y:s});h.left<0?o.lockSide.left&&(n-=h.left):h.right>0&&o.lockSide.right&&(n-=h.right),h.top<0?o.lockSide.top&&(s-=h.top):h.bottom>0&&o.lockSide.bottom&&(s-=h.bottom)}return(n||s)&&(o.offset(n,s),o.__mvMonitor.curposition.x=t.position.x,o.__mvMonitor.curposition.y=t.position.y),!1}},this.__mvMonitor.mu=function(t){var o=e;o.__mvMonitor.mouseDown&&(o.__mvMonitor.mouseDown=!1,o.cursor("default"),o.emit("moveend",{position:o.__mvMonitor.curposition}))},this.__mvMonitor.ml=function(){var t=e;return t.__mvMonitor.mouseDown?(t.__mvMonitor.mouseDown=!1,t.cursor("default"),t.emit("moveend",{position:t.__mvMonitor.curposition}),!1):void 0},this.__mvMonitor.md=function(t){var o=e;if(!o.__mvMonitor.mouseDown&&(0==t.button||1==t.button)){o.__mvMonitor.mouseDown=!0,o.cursor("move");var i=o.parent.absoluteBounds||o.parent.getAbsoluteBounds();return o.__mvMonitor.curposition.x=t.position.x+i.left,o.__mvMonitor.curposition.y=t.position.y+i.top,o.emit("movestart",{position:o.__mvMonitor.curposition}),t.cancel=!0,!1}}}o=o||this.graph||this.findParent("jmGraph"),o&&t?(o.bind("mousemove",this.__mvMonitor.mv),o.bind("mouseup",this.__mvMonitor.mu),o.bind("mouseleave",this.__mvMonitor.ml),this.bind("mousedown",this.__mvMonitor.md),o.bind("touchmove",this.__mvMonitor.mv),o.bind("touchend",this.__mvMonitor.mu),this.bind("touchstart",this.__mvMonitor.md)):(o.unbind("mousemove",this.__mvMonitor.mv),o.unbind("mouseup",this.__mvMonitor.mu),o.unbind("mouseleave",this.__mvMonitor.ml),this.unbind("mousedown",this.__mvMonitor.md),o.unbind("touchmove",this.__mvMonitor.mv),o.unbind("touchend",this.__mvMonitor.mu),this.unbind("touchstart",this.__mvMonitor.md))};
function jmGradient(t){if(t)for(var e in t)this[e]=t[e];this.stops=new jmUtils.list}jmGradient.prototype.addColorStop=jmGradient.prototype.addStop=function(t,e){this.stops.add({offset:t,color:e})},jmGradient.prototype.toGradient=function(t){var e,i=t.context||t,o=t.absoluteBounds?t.absoluteBounds:t.getAbsoluteBounds(),s=this.x1,r=this.y1,n=this.x2,c=this.y2,a=t.getLocation(),h=0;if(a.radius&&(h=2*a.radius),h||(h=Math.min(a.width,a.height)),jmUtils.checkPercent(s)&&(s=jmUtils.percentToNumber(s)*(a.width||h)),jmUtils.checkPercent(n)&&(n=jmUtils.percentToNumber(n)*(a.width||h)),jmUtils.checkPercent(r)&&(r=jmUtils.percentToNumber(r)*(a.height||h)),jmUtils.checkPercent(c)&&(c=jmUtils.percentToNumber(c)*(a.height||h)),"linear"===this.type)"canvas"==t.mode?e=i.createLinearGradient(s+o.left,r+o.top,n+o.left,c+o.top):(e=Raphael.deg(Math.atan2(c-r,n-s))+"-",this.stops.each(function(t,i){e+=i.color+":"+Math.floor(100*i.offset)+"-"}),e=jmUtils.trimEnd(e,"-"));else if("radial"===this.type){var l=this.r1,m=this.r2;jmUtils.checkPercent(l)&&(l=jmUtils.percentToNumber(l),l=h*l),jmUtils.checkPercent(m)&&(m=jmUtils.percentToNumber(m),m=h*m),"canvas"==t.mode?e=i.createRadialGradient(s+o.left,r+o.top,l,n+o.left,c+o.top,m):(e="r(",this.stops.each(function(t,i){e+=i.offset+","}),e=jmUtils.trimEnd(e,",")+")",this.stops.each(function(t,i){e+=i.color+"-"}),e=jmUtils.trimEnd(e,"-"))}return"canvas"==t.mode&&this.stops.each(function(t,i){e.addColorStop(i.offset,i.color)}),e},jmGradient.prototype.toString=function(){};
function jmShadow(t,o,i,h){this.x=t,this.y=o,this.blur=i,this.color=h,this.toGlow=function(){return{width:this.blur,offsetx:this.x,offsety:this.y,color:this.color}}}
function jmShape(t){this.type="jmShape",this.graph=t,this.initializing(t.context,style)}jmUtils.extend(jmShape,jmControl);
function jmPath(t,i){this.type="jmPath";var s=i&&i.style?i.style:null;this.graph=t,this.points=i&&i.points?i.points:[],this.initializing(t.context,s)}jmUtils.extend(jmPath,jmShape),jmPath.prototype.checkPoint=function(t){var i=this.style.lineWidth||1;if(this.points.length>2&&(!this.style.fill||this.style.stroke)){for(var s=0,n=this.points.length,o=s+1;n>=o;o=++s+1)if(o==n){if(this.style.close){var h=jmUtils.pointInPolygon(t,[this.points[s],this.points[0]],i);if(h)return!0}}else{var l=jmUtils.pointInPolygon(t,[this.points[s],this.points[o]],i);if(l)return!0}if(!this.style.fill)return!1}var h=jmUtils.pointInPolygon(t,this.points,i);return h};
function jmArc(t,i){i||(i={}),this.points=i.points||[];var e=i.style||{};this.type="jmArc",this.graph=t,this.center(i.center||{x:0,y:0}),this.radius(i.radius||0),this.startAngle(i.start||0),this.endAngle(i.end||2*Math.PI),this.width(i.width||0),this.height(i.height||0),this.anticlockwise(i.anticlockwise||0),this.initializing(t.context,e)}jmUtils.extend(jmArc,jmPath),jmArc.prototype.initPoints=function(){var t=this.getLocation(),i=0,e=0,s=t.center.x,n=t.center.y;t.radius?i=e=t.radius:(i=t.width/2,e=t.height/2);var r=this.startAngle(),h=this.endAngle(),o=this.anticlockwise();if(this.points=[],h>r)for(var a=r;h>=a;a+=.01){var c=o?-a:a,u={x:Math.cos(c)*i+s,y:Math.sin(c)*e+n};this.points.push(u)}else for(var a=r;a>=h;a-=.01){var c=o?-a:a,u={x:Math.cos(c)*i+s,y:Math.sin(c)*e+n};this.points.push(u)}return this.points},jmArc.prototype.center=function(t){return this.setValue("center",t)},jmArc.prototype.radius=function(t){return this.setValue("radius",t)},jmArc.prototype.startAngle=function(t){return this.setValue("startAngle",t)},jmArc.prototype.endAngle=function(t){return this.setValue("endAngle",t)},jmArc.prototype.anticlockwise=function(t){return this.setValue("anticlockwise",t)};
function jmArraw(t,s){s||(s={}),this.points=s.points||[];var i=s.style||{};this.type="jmArraw",i.lineJoin="miter",i.lineCap="square",this.graph=t,this.angle(s.angle||0),this.start(s.start||0),this.end(s.end||0),this.offsetX(s.offsetX||5),this.offsetY(s.offsetY||8),this.initializing(t.context,i)}jmUtils.extend(jmArraw,jmPath),jmArraw.prototype.initPoints=function(t){var s=this.angle(),i=this.start(),n=this.end();if(n){s||(s=Math.atan2(n.y-i.y,n.x-i.x)),this.points=[];var e=this.offsetX(),r=this.offsetY(),o=Math.atan2(e,r),a=s+o,h=Math.sin(a),p=Math.cos(a),f=Math.sqrt(e*e+r*r),u=h*f,l=p*f,y={x:n.x-l,y:n.y-u},m=s-o;h=Math.sin(m),p=Math.cos(m),u=h*f,l=p*f;var j={x:n.x-l,y:n.y-u},c=jmUtils.clone(n);return c.m=!0,this.points.push(c),this.points.push(y),t||this.style.fill?(this.points.push(j),this.points.push(c)):(this.points.push(c),this.points.push(j)),this.points}},jmArraw.prototype.start=function(t){return this.setValue("start",t)},jmArraw.prototype.end=function(t){return this.setValue("end",t)},jmArraw.prototype.angle=function(t){return this.setValue("angle",t)},jmArraw.prototype.offsetX=function(t){return this.setValue("offsetX",t)},jmArraw.prototype.offsetY=function(t){return this.setValue("offsetY",t)};
function jmBezier(t,i){i||(i={}),this.type="jmBezier",this.points=i.points||[];var e=i.style||{};this.graph=t,this.cpoints(this.points),this.initializing(t.context,e)}jmUtils.extend(jmBezier,jmPath),jmBezier.prototype.initPoints=function(){this.points=[];for(var t=this.cpoints(),i=0;1>=i;i+=.01){var e=this.getPoint(t,i);this.points.push(e)}return this.points.push(t[t.length-1]),this.points},jmBezier.prototype.getPoint=function(t,i){if(1==t.length)return t[0];if(2==t.length){var e={};return e.x=(t[1].x-t[0].x)*i+t[0].x,e.y=(t[1].y-t[0].y)*i+t[0].y,e}if(t.length>2){for(var n=[],s=0;s<t.length-1;s++){var e=this.getPoint([t[s],t[s+1]],i);e&&n.push(e)}return this.getPoint(n,i)}},jmBezier.prototype.offset=function(t,i,e){var n=this.cpoints();if(n){for(var s=n.length,o=0;s>o;o++)n[o].x+=t,n[o].y+=i;this.emit("move",{offsetX:t,offsetY:i,trans:e}),this.getLocation(!0),this.graph.refresh()}},jmBezier.prototype.cpoints=function(t){return this.setValue("cpoints",t)};
function jmCircle(t,i){i||(i={}),this.type="jmCircle",this.points=i.points||[];var e=i.style||{};this.graph=t,this.center(i.center||{x:0,y:0}),this.width(i.width||0),this.height(i.height||0),this.radius(i.radius||0),this.initializing(t.context,e)}jmUtils.extend(jmCircle,jmPath),jmCircle.prototype.initPoints=function(){var t=this.getLocation();t.radius||(t.radius=Math.min(t.width,t.height)/2),this.points=[],this.points.push({x:t.center.x-t.radius,y:t.center.y-t.radius}),this.points.push({x:t.center.x+t.radius,y:t.center.y-t.radius}),this.points.push({x:t.center.x+t.radius,y:t.center.y+t.radius}),this.points.push({x:t.center.x-t.radius,y:t.center.y+t.radius})},jmCircle.prototype.draw=function(){var t=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds,i=this.getLocation();i.radius||(i.radius=Math.min(i.width,i.height)/2),this.mode&&"canvas"!=this.mode?(this.svgShape||(this.svgShape=this.context.create("circle",this),this.setStyle(),this.svgShape.appendTo(this.graph.canvas)),this.svgShape.setStyle(this),this.svgShape.attr({cx:i.center.x+t.left,cy:i.center.y+t.top,r:i.radius})):this.context.arc(i.center.x+t.left,i.center.y+t.top,i.radius,0,2*Math.PI)},jmCircle.prototype.center=function(t){return this.setValue("center",t)},jmCircle.prototype.radius=function(t){return this.setValue("radius",t)};
function jmHArc(t,i){i||(i={}),this.type="jmHArc",this.points=i.points||[];var e=i.style||{};this.graph=t,this.center(i.center||{x:0,y:0}),this.minRadius(i.minRadius||e.minRadius||0),this.maxRadius(i.maxRadius||e.maxRadius||0),this.startAngle(i.start||0),this.endAngle(i.end||2*Math.PI),this.width(i.width||0),this.height(i.height||0),this.anticlockwise(i.anticlockwise||0),this.initializing(t.context,e)}jmUtils.extend(jmHArc,jmPath),jmHArc.prototype.initPoints=function(){for(var t=this.getLocation(),i=this.minRadius(),e=this.maxRadius(),s=this.startAngle(),n=this.endAngle(),r=this.anticlockwise(),a=[],c=[],h=s;n>=h;h+=.1){var o=r?-h:h,u=Math.cos(o),l=Math.sin(o),m={x:u*i+t.center.x,y:l*i+t.center.y},p={x:u*e+t.center.x,y:l*e+t.center.y};a.push(m),c.push(p)}c.reverse(),this.style&&this.style.close||(c[0].m=!0),this.points=a.concat(c)},jmHArc.prototype.center=function(t){return this.setValue("center",t)},jmHArc.prototype.minRadius=function(t){return this.setValue("minRadius",t)},jmHArc.prototype.maxRadius=function(t){return this.setValue("maxRadius",t)},jmHArc.prototype.startAngle=function(t){return this.setValue("startAngle",t)},jmHArc.prototype.endAngle=function(t){return this.setValue("endAngle",t)},jmHArc.prototype.anticlockwise=function(t){return this.setValue("anticlockwise",t)};
function jmLine(t,s){s||(s={}),this.type="jmLine",this.points=s.points||[];var i=s.style||{};this.graph=t,this.start(s.start||{x:0,y:0}),this.end(s.end||{x:0,y:0}),i.lineType=i.lineType||"solid",i.dashLength=i.dashLength||4,this.initializing(t.context,i)}jmUtils.extend(jmLine,jmPath),jmLine.prototype.initPoints=function(){var t=this.start(),s=this.end();if(this.points=[],this.points.push(t),"dotted"===this.style.lineType){var i=s.x-t.x,n=s.y-t.y,e=Math.sqrt(i*i+n*n);i/=e,n/=e;for(var h=!1,o=this.style.dashLength/2,p=this.style.dashLength;e>=p;)0==h?(this.points.push({x:t.x+i*p,y:t.y+n*p}),p+=o):(this.points.push({x:t.x+i*p,y:t.y+n*p,m:!0}),p+=this.style.dashLength),h=!h}return this.points.push(s),this.points},jmLine.prototype.start=function(t){return this.setValue("start",t)},jmLine.prototype.end=function(t){return this.setValue("end",t)};
function jmPrismatic(t,i){i||(i={}),this.type="jmPrismatic",this.points=i.points||[];var e=i.style||{};this.graph=t,this.center(i.center||{x:0,y:0}),this.width(i.width||0),this.height(i.height||0),this.initializing(t.context,e)}jmUtils.extend(jmPrismatic,jmPath),jmPrismatic.prototype.initPoints=function(){var t=this.getLocation(),i=t.width/2,e=t.height/2;this.points=[],this.points.push({x:t.center.x-i,y:t.center.y}),this.points.push({x:t.center.x,y:t.center.y+e}),this.points.push({x:t.center.x+i,y:t.center.y}),this.points.push({x:t.center.x,y:t.center.y-e})},jmPrismatic.prototype.center=function(t){return this.setValue("center",t)};
function jmRect(t,i){i||(i={}),this.type="jmRect",this.points=i.points||[];var s=i.style||{};s.close=!0,this.graph=t,this.position(i.position||{x:0,y:0}),this.width(i.width||0),this.height(i.height||0),this.radius(i.radius||s.radius||0),this.initializing(t.context,s)}jmUtils.extend(jmRect,jmPath),jmRect.prototype.getBounds=function(){var t={};this.initPoints();var i=this.getLocation();return t.left=i.left,t.top=i.top,t.right=i.x+i.width,t.bottom=i.y+i.height,t.width=t.right-t.left,t.height=t.bottom-t.top,t},jmRect.prototype.checkPoint=function(t){var i=this.bounds||this.getBounds();return t.x>i.right||t.x<i.left?!1:t.y>i.bottom||t.y<i.top?!1:!0},jmRect.prototype.initPoints=function(){var t=this.getLocation(),i={x:t.left,y:t.top},s={x:t.left+t.width,y:t.top},e={x:t.left+t.width,y:t.top+t.height},a={x:t.left,y:t.top+t.height};if(t.radius&&t.radius<t.width/2&&t.radius<t.height/2){var h=Math.PI/2,r=this.graph.createShape("arc",{radius:t.radius,anticlockwise:!1});r.center({x:t.left+t.radius,y:t.top+t.radius}),r.startAngle(Math.PI),r.endAngle(Math.PI+h);var n=r.initPoints();r=this.graph.createShape("arc",{radius:t.radius,anticlockwise:!1}),r.center({x:s.x-t.radius,y:s.y+t.radius}),r.startAngle(Math.PI+h),r.endAngle(2*Math.PI);var o=r.initPoints();r=this.graph.createShape("arc",{radius:t.radius,anticlockwise:!1}),r.center({x:e.x-t.radius,y:e.y-t.radius}),r.startAngle(0),r.endAngle(h);var p=r.initPoints();r=this.graph.createShape("arc",{radius:t.radius,anticlockwise:!1}),r.center({x:a.x+t.radius,y:a.y-t.radius}),r.startAngle(h),r.endAngle(Math.PI);var u=r.initPoints();this.points=n.concat(o,p,u)}else this.points=[],this.points.push(i),this.points.push(s),this.points.push(e),this.points.push(a);return this.points},jmRect.prototype.radius=function(t){return this.setValue("radius",t)};
function jmArrawLine(i,t){t||(t={}),this.points=t.points||[];var n=t.style||{};n.lineJoin="miter",this.graph=i,this.type="jmArrawLine",this.start=t.start||(t.start={x:0,y:0}),this.end=t.end||(t.end={x:0,y:0}),this.initializing(i.context,n),this.line=i.createShape("line",t),this.arraw=i.createShape("arraw",t)}jmUtils.extend(jmArrawLine,jmPath),jmArrawLine.prototype.initPoints=function(){return this.points=this.line.initPoints(),this.arrawVisible!==!1&&(this.points=this.points.concat(this.arraw.initPoints())),this.points};
function jmImage(t,e){var i=e&&e.style?e.style:{};this.graph=t,this.width(e.width),this.height(e.height),this.type="jmImage",this.position(e.position||{x:0,y:0}),this.sourceWidth(e.swidth),this.sourceHeight(e.sheight),this.sourcePosition(e.sposition),this.image(e.image||i.image),this.initializing(t.context,i)}jmUtils.extend(jmImage,jmControl),jmImage.prototype.draw=function(){try{var t=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;t||(t=this.parent&&this.parent.getAbsoluteBounds?this.parent.getAbsoluteBounds():this.getAbsoluteBounds());var e=this.getLocation();e.left+=t.left,e.top+=t.top;var i=this.sourcePosition(),h=this.sourceWidth(),o=this.sourceHeight(),s=this.image();(h||o)&&(h||(h=e.width),o||(o=e.height),i||(i={x:0,y:0})),i?e.width&&e.height?this.context.drawImage(s,i.x,i.y,h,o,e.left,e.top,e.width,e.height):e.width?this.context.drawImage(s,i.x,i.y,h,o,e.left,e.top,e.width,s.height):e.height?this.context.drawImage(s,i.x,i.y,h,o,e.left,e.top,s.width,e.height):this.context.drawImage(s,i.x,i.y,h,o,e.left,e.top):e?e.width&&e.height?this.context.drawImage(s,e.left,e.top,e.width,e.height):e.width?this.context.drawImage(s,e.left,e.top,e.width,s.height):e.height?this.context.drawImage(s,e.left,e.top,s.width,e.height):this.context.drawImage(s,e.left,e.top):this.context.drawImage(this.image())}catch(n){console.log(n)}},jmImage.prototype.getBounds=function(){var t={},e=this.image(),i=this.getLocation(),h=i.width||e.width,o=i.height||e.height;return t.left=i.left,t.top=i.top,t.right=i.left+h,t.bottom=i.top+o,t.width=h,t.height=o,t},jmImage.prototype.image=function(t){if(t&&"string"==typeof t){var e=document.createElement("img");e.src=t,t=e}return this.setValue("image",t)},jmImage.prototype.position=function(t){return this.setValue("position",t)},jmImage.prototype.sourcePosition=function(t){return this.setValue("sourcePosition",t)},jmImage.prototype.sourceWidth=function(t){return this.setValue("sourceWidth",t)},jmImage.prototype.sourceHeight=function(t){return this.setValue("sourceHeight",t)};
function jmLabel(t,i){i||(i={});var e=i.style||{};e.font=e.font||"15px Arial",this.type="jmLabel",e.textAlign=e.textAlign||"left",e.textBaseline=e.textBaseline||"middle",this.graph=t,this.value=i.value,this.position(i.position||{x:0,y:0}),this.width(i.width||0),this.height(i.height||0),"canvas"!=t.mode&&(this.svgShape=t.context.create("text",this)),this.initializing(t.context,e)}jmUtils.extend(jmLabel,jmControl),jmLabel.prototype.initPoints=function(){{var t=this.getLocation();t.width,t.height}return this.points=[{x:t.left,y:t.top}],this.points.push({x:t.left+t.width,y:t.top}),this.points.push({x:t.left+t.width,y:t.top+t.height}),this.points.push({x:t.left,y:t.top+t.height}),this.points},jmLabel.prototype.testSize=function(){this.context.save(),this.setStyle();var t=this.context.measureText?this.context.measureText(this.value):{width:this.svgShape?this.svgShape.element.getBBox().width:15};return this.context.restore(),t.height=15,t},jmLabel.prototype.draw=function(){var t=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds,i=this.getLocation(),e=i.left+t.left,s=i.top+t.top;switch(this.style.textAlign){case"right":e+=i.width;break;case"center":e+=i.width/2}switch(this.style.textBaseline){case"bottom":s+=i.height;break;case"hanging":case"alphabetic":case"middle":s+=i.height/2}"canvas"==this.mode?(this.value&&(this.style.fill&&this.context.fillText?this.style.maxWidth?this.context.fillText(this.value,e,s,this.style.maxWidth):this.context.fillText(this.value,e,s):this.context.strokeText&&(this.style.maxWidth?this.context.strokeText(this.value,e,s,this.style.maxWidth):this.context.strokeText(this.value,e,s))),this.style.border&&(this.context.moveTo(this.points[0].x+t.left,this.points[0].y+t.top),this.style.border.top&&this.context.lineTo(this.points[1].x+t.left,this.points[1].y+t.top),this.style.border.right&&(this.context.moveTo(this.points[1].x+t.left,this.points[1].y+t.top),this.context.lineTo(this.points[2].x+t.left,this.points[2].y+t.top)),this.style.border.bottom&&(this.context.moveTo(this.points[2].x+t.left,this.points[2].y+t.top),this.context.lineTo(this.points[3].x+t.left,this.points[3].y+t.top)),this.style.border.left&&(this.context.moveTo(this.points[3].x+t.left,this.points[3].y+t.top),this.context.lineTo(this.points[0].x+t.left,this.points[0].y+t.top)))):this.svgShape.attr({x:e,y:s,text:this.value})},jmLabel.prototype.width=function(t){return t?this.setValue("width",t):(t=this.getValue("width"))?t:this.context?this.testSize().width:void 0};
function jmResize(i,t){this.params=t||{};var e=t.style||{};this.type="jmResize",this.enabled=t.enabled===!1?!1:!0,this.graph=i,this.points=t.points||[],this.position(t.position||{x:0,y:0}),this.width(t.width||0),this.height(t.height||0),this.rectSize(t.rectSize||10),this.initializing(i.context,e),this.init()}jmUtils.extend(jmResize,jmRect),jmResize.prototype.init=function(){if(this.params.resizable!==!1){this.resizeRects=[];for(var i=this.rectSize(),t=0;8>t;t++){var e=this.graph.createShape("rect",{position:{x:0,y:0},width:i,height:i,style:{stroke:this.style.rectStroke||"red",close:!0,zIndex:100}});e.index=t,e.visible=!0,this.resizeRects.push(e),this.children.add(e),e.canMove(!0,this.graph)}this.reset(0,0,0,0),this.bindRectEvents()}},jmResize.prototype.bindRectEvents=function(){var i=this;for(var t in this.resizeRects){var e=this.resizeRects[t];e.on("move",function(t){var e=0,s=0,h=0,o=0;0==this.index?(h=-t.offsetX,e=t.offsetX):1==this.index?(h=-t.offsetX,e=t.offsetX,o=-t.offsetY,s=t.offsetY):2==this.index?(o=-t.offsetY,s=t.offsetY):3==this.index?(h=t.offsetX,o=-t.offsetY,s=t.offsetY):4==this.index?h=t.offsetX:5==this.index?(h=t.offsetX,o=t.offsetY):6==this.index?o=t.offsetY:7==this.index&&(h=-t.offsetX,e=t.offsetX,o=t.offsetY),i.reset(e,s,h,o)}),e.bind("mousemove",function(){var i=["w-resize","nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize"];this.cursor(i[this.index])}),e.bind("mouseleave",function(){this.cursor("default")})}},jmResize.prototype.reset=function(i,t,e,s){var h=5,o=this.getLocation();if(0!=e||0!=s){var n=o.width+e,r=o.height+s;if(n>=h&&r>=h){if(this.width(n),this.height(r),this.params.movable!==!1){var f=this.position();f.x=o.left+i,f.y=o.top+t,this.position(f)}this.emit("resize",i,t,e,s)}}for(var a in this.resizeRects){var p=this.resizeRects[a];switch(p.index){case 0:p.position().x=-p.width()/2,p.position().y=(o.height-p.height())/2;break;case 1:p.position().x=-p.width()/2,p.position().y=-p.height()/2;break;case 2:p.position().x=(o.width-p.width())/2,p.position().y=-p.height()/2;break;case 3:p.position().x=o.width-p.width()/2,p.position().y=-p.height()/2;break;case 4:p.position().x=o.width-p.width()/2,p.position().y=(o.height-p.height())/2;break;case 5:p.position().x=o.width-p.width()/2,p.position().y=o.height-p.height()/2;break;case 6:p.position().x=(o.width-p.height())/2,p.position().y=o.height-p.height()/2;break;case 7:p.position().x=-p.width()/2,p.position().y=o.height-p.height()/2}}},jmResize.prototype.rectSize=function(i){return this.setValue("rectSize",i)},jmResize.prototype.target=function(i){return this.setValue("target",i)};
function jmTooltip(t,e){e||(e={});var i=e.style||{};i.font=i.font||"15px Arial",this.type="jmTooltip",this.graph=t,this.position(e.position||{x:0,y:0}),this.initializing(t.context,i),this.element=document.createElement("div"),this.element.className="jm-tooltip",this.element.style.position="absolute",this.element.style.display="none",this.value(e.value),document.body.appendChild(this.element)}jmUtils.extend(jmTooltip,jmControl),jmTooltip.prototype.setStyle=function(t){if(t=t||this.style,t&&"object"==typeof t)for(var e in t)if("string"==typeof e&&"string"==typeof t[e])try{this.element.style[e]=t[e]}catch(i){window.console.log(i)}},jmTooltip.prototype.draw=function(){this.setPosition()},jmTooltip.prototype.setPosition=function(t,e){this.x=t||this.x||0,this.y=e||this.y||0;var i=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds,o=this.getLocation();t=this.x+o.left+i.left,e=this.y+o.top+i.top;var n=this.graph.getPosition();t+=n.left,e+=n.top,this.element.style.top=e+"px",this.element.style.left=t+"px"},jmTooltip.prototype.remove=function(){this.element&&document.body.removeChild(this.element)},jmTooltip.prototype.show=function(){this.element&&(this.element.style.display="inline")},jmTooltip.prototype.hide=function(){this.element&&(this.element.style.display="none")},jmTooltip.prototype.value=function(t){return this.element?(void 0!==t&&(this.element.innerHTML=t),this.element.innerHTML):void 0},jmTooltip.prototype.width=function(t){return this.element?(void 0!==t&&(this.element.style.width=t+"px"),this.element.clientWidth):void 0},jmTooltip.prototype.height=function(t){return this.element?(void 0!==t&&(this.element.style.height=t+"px"),this.element.clientHeight):void 0};
function jmCell(t){this.option=t,this.type="jmCell",this.value(t.value||""),this.graph=t.graph,this.editor=t.editor,this.styleName=t.style,this.setStyle(this.styleName),t.position=t.position||{x:0,y:0},t.width?this.width(t.width):this.style.width&&(this.width(this.style.width),t.position.x-=this.style.width/2),t.height?this.height(t.height):this.style.height&&(this.height(this.style.height),t.position.y-=this.style.height/2),this.position(t.position),this.selected=!1,this.initializing(this.graph.context,this.style),"undefined"!=typeof t.resizable?this.resizable=t.resizable:"undefined"!=typeof this.style.resizable&&(this.resizable=this.style.resizable),this.connectable="undefined"!=typeof t.connectable?t.connectable:"undefined"!=typeof this.style.connectable?this.style.connectable:this.editor.connectable}jmUtils.extend(jmCell,jmControl),jmCell.prototype.setStyle=function(t){if(t){var e=this.editor.styles[t];e?(this.styleName=t,this.style=jmUtils.clone(e)):(this.style=jmUtils.clone(t),e=t),"undefined"!=typeof this.style.resizable&&(this.resizable=this.style.resizable),this.style.zIndex=this.style.zIndex||1e3,this.fontStyle=e.fontStyle||this.editor.defaultStyle.font,this.style.padding=this.style.padding||{left:8,top:8,right:8,bottom:8},this.label&&(this.label.style=this.fontStyle),this.shape&&(e.zIndex=0,this.shape.style=e)}},jmCell.prototype.create=function(){this.connects=new jmUtils.list;var t=this.width(),e=this.height();this.center={x:t/2,y:e/2};var i;i=this.style.borderStyle?this.style.borderStyle:{stroke:this.style.borderStroke||this.editor.defaultStyle.cellBorder.stroke,rectStroke:this.style.borderStroke||this.editor.defaultStyle.cellBorder.stroke,close:!0},this.rect=this.graph.createShape("resize",{width:t,height:e,movable:!1,resizable:this.resizable,style:i}),this.rect.visible=!1;var s=this.option.shape||this.style.shape;if(s){var h=jmUtils.extend({style:this.style,width:"94%",height:"94%",center:this.center,position:{x:"3%",y:"3%"}},this.option);this.shape=this.graph.createShape(s,h)}if(this.connectable){var o=8,l=this.graph.createRadialGradient(o/2,o/2,0,o/2,o/2,o);l.addStop(0,"#00FF00"),l.addStop(1,"#059505"),this.connArc=this.graph.createShape("arc",{center:{x:"50%",y:"50%"},width:o,height:o,radius:o,style:{fill:l,close:!0,zIndex:200}}),this.connArc.visible=!1,this.connectLine=this.graph.createShape("arrawline",{start:this.center,end:this.connArc.center(),offsetX:6,offsetY:12,style:this.editor.defaultStyle.dragLine}),this.connectLine.visible=!1,this.children.add(this.connectLine)}this.label=this.graph.createShape("label",{style:this.fontStyle,width:"100%",height:"100%",value:this.value()}),this.setStyle(this.styleName)},jmCell.prototype.add=function(){this.create(),this.children.add(this.rect),this.graph.children.add(this),this.editor.movable&&this.canMove(!0),this.shape&&this.children.add(this.shape),this.bind("mousedown",function(t){t.ctrlKey||this.selected||this.editor.selectAll(!1,this.id),this.selected||this.select(!0),t.cancel=!0}),this.bind("mouseup",function(t){var e=this.editor.connectFrom;e&&(e!=this&&e.connect(this)!==!1&&this.editor.save(),this.editor.connectFrom=null)}),this.connectable&&(this.bind("mousemove",function(){this.connArc.visible=!0,this.graph.refresh()}),this.bind("mouseleave",function(){this.editor.connectFrom!=this&&(this.connArc.visible=!1,this.graph.refresh())}),this.children.add(this.connArc),this.connArc.canMove(!0),this.connArc.on("movestart",function(e){var i=t;i.editor.connectFrom=i,i.connectLine.visible=!0}),this.connArc.on("moveend",function(e){var i=t,s=i.connArc.center();s.x="50%",s.y="50%",i.editor.connectFrom=null,i.connectLine.visible=!1,i.connArc.visible=!1,i.graph.refresh()})),this.on("move",function(t){this.initPosition()}),this.children.add(this.label),this.resize();var t=this;this.rect.on("resize",function(e,i,s,h){var o=t;o.position().x+=e,o.position().y+=i;var l=o.width()+s,n=o.height()+h;o.width(l),o.height(n),o.resize()})},jmCell.prototype.setOverlay=function(t,e,i,s){if(!this.overlay){this.overlay=document.createElement("img"),this.overlay.style.position="absolute";var h=this.getAbsoluteBounds(),o=h.bottom,l=h.right;this.style&&this.style.overlay&&this.style.overlay.margin&&(this.style.overlay.margin.left&&(l+=this.style.overlay.margin.left),this.style.overlay.margin.top&&(o+=this.style.overlay.margin.top)),this.overlay.style.top=o+"px",this.overlay.style.left=l+"px",this.overlay.style.border="0",this.editor.container.appendChild(this.overlay)}return t?(this.overlay.src=t,this.overlay.width=e,this.overlay.height=i,this.overlay.title=s):this.overlay.visible=!1,this.overlay},jmCell.prototype.resize=function(){var t=this.width(),e=this.height(),i=this.center;this.style.padding?(t=t-(this.style.padding.left||0)-(this.style.padding.right||0),e=e-(this.style.padding.top||0)-(this.style.padding.bottom||0),i.x=t/2+(this.style.padding.left||0),i.y=e/2+(this.style.padding.top||0)):(i.x=t/2,i.y=e/2),this.connArc&&(this.connArc.center().x=i.x,this.connArc.center().y=i.y),this.initPosition()},jmCell.prototype.initPosition=function(){var t=this.position();if(this.pos1||(this.pos1={}),this.pos1.x=t.x,this.pos1.y=t.y+this.height()/2,this.pos2||(this.pos2={}),this.pos2.x=t.x+this.width()/2,this.pos2.y=t.y,this.pos3||(this.pos3={}),this.pos3.x=t.x+this.width(),this.pos3.y=this.pos1.y,this.pos4||(this.pos4={}),this.pos4.x=this.pos2.x,this.pos4.y=t.y+this.height(),this.rect.width(this.width()),this.rect.height(this.height()),this.overlay)if("IMG"==this.overlay.tagName){var e=this.getAbsoluteBounds(),i=e.bottom,s=e.right;this.style&&this.style.overlay&&this.style.overlay.margin&&(this.style.overlay.margin.left&&(s+=this.style.overlay.margin.left),this.style.overlay.margin.top&&(i+=this.style.overlay.margin.top)),this.overlay.style.top=i+"px",this.overlay.style.left=s+"px"}else{var h=this.overlay.position();h.x=this.width(),h.y=this.height()}},jmCell.prototype.select=function(t,e){var i=!1;t===!1&&this.selected===!0?(this.rect.visible=!1,this.selected=!1,i=!0):t!==!0||this.selected||(this.selected=!0,this.rect.visible=!0,i=!0),i&&(this.graph.refresh(),e!==!1&&this.emit("select",this.selected))},jmCell.prototype.connect=function(t,e,i){var s=this.connects.get(function(e){return e.from==this&&e.to==t});if(!s){if(this.editor.validConnect&&!this.editor.validConnect(this,t))return!1;e=e||this.editor.maxId(),s=this.graph.createShape("cellConnectLine",{id:e,from:this,to:t,style:jmUtils.clone(this.style.connectLine),editor:this.editor}),this.connects.add(s),t.connects.add(s),s.value(i),this.graph.children.add(s),this.editor.connects.add(s),s.bind("mouseover",function(){if(!this.selected){var t=this.style&&this.style.overStroke?this.style.overStroke:jmEditorDefaultStyle.connectLine.overStroke;this.style.stroke=t,this.style.zIndex=2e3,this.graph.refresh()}}),s.bind("mouseleave",function(){if(!this.selected){var t=this.style&&this.style.normalStroke?this.style.normalStroke:jmEditorDefaultStyle.connectLine.stroke;this.style.stroke=t,this.style.zIndex=1,this.graph.refresh()}}),s.bind("mousedown",function(t){var e=this.selected;return t.ctrlKey||this.selected||this.editor.selectAll(!1,this.id),this.select(!e),!1})}},jmCell.prototype.value=function(t){return"undefined"!=typeof t?(this.label&&(this.label.value=t),this.setValue("value",t)):this.getValue("value")},jmCell.prototype.center=function(t){return this.setValue("center",t)},jmCell.prototype.remove=function(t){t||(this.editor&&(this.editor.cells.remove(this),this.graph.children.remove(this),this.overlay&&this.overlay.parentElement&&this.overlay.parentElement.removeChild(this.overlay)),this.connects.each(function(t,e){e.remove()},!0))};
function jmConnectLine(t,s){this.graph=t,this.editor=s.editor,this.id=s.id,this.from=s.from,this.to=s.to,this.selected=!1,this.points=s.points||[];var e=s.style||{stroke:this.editor.defaultStyle.connectLine.stroke,lineWidth:this.editor.defaultStyle.connectLine.lineWidth,zIndex:1};this.type="jmConnectLine",e.close=!1,this.initializing(t.context,e),s=jmUtils.extend({start:s.from.outPos2,end:s.to.inPos},s);var i=jmUtils.clone(s.style);i.fill=e.stroke,s.style=i,this.arraw=t.createShape("arraw",s),this.children.add(this.arraw);var o=this.style.fontStyle||this.editor.defaultStyle.font;this.label=this.graph.createShape("label",{style:o}),this.on("add",function(t){t.children.add(t.label)}),this.on("beginDraw",function(t){var s=t.bounds;t.label.width(s.width),t.label.height(s.height)}),this.selected=!1}jmUtils.extend(jmConnectLine,jmPath),jmConnectLine.prototype.initPoints=function(){var t=this.from.pos4,s=this.to.pos2,e=this.to.position(),i=this.from.position();if(i.x+this.from.width()<e.x){t=this.from.pos3;var o=e.y-i.y-this.from.height();o>0?(t=o>30?this.from.pos4:this.from.pos3,s=this.to.pos2):s=i.y>e.y+this.to.height()?this.to.pos4:this.to.pos1}else if(i.x>e.x+this.to.width()){t=this.from.pos1;var o=e.y-i.y-this.from.height();o>0?(t=o>30?this.from.pos4:this.from.pos1,s=this.to.pos2):s=i.y>e.y+this.to.height()?this.to.pos4:this.to.pos3}else i.y>e.y+this.to.height()&&(t=this.from.pos1,s=this.to.pos1);return this.points=this.getPoints(t,s),this.points},jmConnectLine.prototype.getPoints=function(t,s){var e=30,i=30,o=[t];if(t==this.from.pos1)switch(s){case this.to.pos1:var h=Math.min(t.x-e,s.x-e),r={x:h,y:t.y};o.push(r);var a={x:h,y:s.y};o.push(a);break;case this.to.pos2:var r={x:s.x,y:t.y};o.push(r);break;case this.to.pos3:var r={x:(t.x-s.x)/2+s.x,y:t.y};o.push(r);var a={x:r.x,y:s.y};o.push(a);break;case this.to.pos4:var r={x:s.x,y:t.y};o.push(r)}else if(t==this.from.pos2)switch(s){case this.to.pos1:var r={x:t.x,y:s.y};o.push(r);break;case this.to.pos2:var r={x:t.x,y:Math.min(t.y-i,s.y-i)};o.push(r);break;case this.to.pos3:var r={x:t.x,y:s.y};o.push(r);break;case this.to.pos4:var r={x:t.x,y:(t.y-s.y)/2+s.y};o.push(r);var a={x:s.x,y:r.y};o.push(a)}else if(t==this.from.pos3)switch(s){case this.to.pos1:var r={x:(s.x-t.x)/2+t.x,y:t.y};o.push(r);var a={x:r.x,y:s.y};o.push(a);break;case this.to.pos2:var r={x:s.x,y:t.y};o.push(r);break;case this.to.pos3:var r={x:Math.max(t.x+e,s.x+e),y:t.y};o.push(r);var a={x:r.x,y:s.y};o.push(a);break;case this.to.pos4:var r={x:s.x,y:t.y};o.push(r)}else if(t==this.from.pos4)switch(s){case this.to.pos1:var r={x:t.x,y:s.y};o.push(r);break;case this.to.pos2:var r={x:t.x,y:Math.max((s.y-t.y)/2+t.y,s.y-i)};o.push(r);var a={x:s.x,y:r.y};o.push(a);break;case this.to.pos3:var r={x:t.x,y:s.y};o.push(r);break;case this.to.pos4:var r={x:t.x,y:Math.max(t.y+e,s.y+e)};o.push(r);var a={x:s.x,y:r.y};o.push(a)}o.push(s);for(var n,y,p=jmUtils.clone(o[o.length-2]),l=jmUtils.clone(s),c=0;c<o.length;c++){var x=o[c];n=Math.min(n||x.x,x.x),y=Math.min(y||x.y,x.y)}return p.x-=n,l.x-=n,p.y-=y,l.y-=y,this.arraw.start(p),this.arraw.end(l),this.arraw.style.stroke=this.arraw.style.fill=this.style.stroke,o},jmConnectLine.prototype.select=function(t){if("undefined"!=typeof t){var s=!1;t&&0==this.selected?(this.style.stroke=this.style&&this.style.selectedStroke?this.style.selectedStroke:this.editor.defaultStyle.connectLine.overStroke,this.style.zIndex=10,this.selected=!0,s=!0):1==this.selected&&(this.style.stroke=this.style&&this.style.normalStroke?this.style.normalStroke:this.editor.defaultStyle.connectLine.stroke,this.style.zIndex=1,this.selected=!1,s=!0),s&&(this.editor.emit("select",this,t),this.graph.refresh())}},jmConnectLine.prototype.value=function(t){return"undefined"!=typeof t&&(this.label.value=t),this.label.value},jmConnectLine.prototype.remove=function(t){t||(this.from&&this.from.connects.remove(this),this.to&&this.to.connects.remove(this),this.editor&&this.editor.connects.remove(this),this.graph.children.remove(this))};
function jmEditor(e){this.option=e,this.cells=new jmUtils.list,this.connects=new jmUtils.list,this.styles={},this.type="jmEditor","undefined"==typeof e.enabled&&(e.enabled=!0),this.isEnabled(e.enabled),this.connectable=e.connectable===!1?!1:!0,this.movable=e.movable===!1?!1:!0,e.container&&("string"==typeof e.container&&(e.container=document.getElementById(e.container)),"CANVAS"!=e.container.tagName?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.style.padding="0",this.container.style.margin="0",this.container.style.width="100%",this.container.style.height="100%",e.container.appendChild(this.container)):(this.container=e.container.parentElement,canvas=e.container),this.graph=new jmGraph(this.container,e.width,e.height),this.selectRect=this.graph.createShape("rect",{style:this.defaultStyle.selectRect}),this.selectRect.visible=!1,this.graph.children.add(this.selectRect),this.graph.registerShape("cellConnectLine",jmConnectLine),this.initEvents())}jmUtils.extend(jmEditor,jmProperty),jmEditor.prototype.defaultStyle={dragLine:{stroke:"rgb(59,111,41)",lineWidth:1,lineType:"dotted",dashLength:6,zIndex:1e4},cellBorder:{stroke:"rgb(0,255,0)"},connectLine:{stroke:"rgb(59,255,41)",overStroke:"red",lineWidth:2},font:{textAlign:"center",textBaseline:"middle",fill:"blue",font:"20px Arial",border:null},selectRect:{stroke:"rgb(0,255,0)",lineWidth:1,zIndex:1e4}},jmEditor.prototype.menus=function(){if(!this.menuBody){var e=this.menuBody={};this.menuBody.panel=document.createElement("div"),this.menuBody.panel.style.display="none",this.menuBody.panel.className="editor-menu",this.menuBody.container=document.createElement("ul"),this.menuBody.panel.appendChild(this.menuBody.container),document.body.appendChild(this.menuBody.panel),this.menuBody.show=function(e,t){if(this.panel.style.display="inline",this.panel.style.position="absolute",e&&t)this.panel.style.top=t+1+"px",this.panel.style.left=e+1+"px";else{var n=jmUtils.getEventPosition(event);this.panel.style.top=n.pageY+1+"px",this.panel.style.left=n.pageX+1+"px"}return this},this.menuBody.add=function(t,n){var i=document.createElement("li");return"string"==typeof t?i.innerHTML=t:i.appendChild(t),i.onmouseup=function(){n&&n.call(this),e.hide()},this.container.appendChild(i),this},this.menuBody.hide=function(){return this.panel.style.display="none",this},this.graph.bind("mousedown",function(t){e.hide()})}return this.menuBody.container.innerHTML="",this.menuBody},jmEditor.prototype.addCell=function(e){e=e||{},e.graph=this.graph,e.editor=this,this.isEnabled()&&this.option.resizable!==!1||(e.resizable=!1);var t=new jmCell(e);if(!this.validCell||this.validCell(t)){var n=this;return t.on("select",function(e){n.emit("select",this,e)}),t.on("move",function(e){var t=n;if(e.trans===!0)for(var i=t.getSelectedCells(),o=0;o<i.length;o++)i[o]!=this&&i[o].offset(e.offsetX,e.offsetY,!1);t.resize(this)}),t.id=e.id||this.maxId(),this.cells.add(t),t.add(),this.resize(t),t}},jmEditor.prototype.maxId=function(){var e=0;return this.cells.each(function(t,n){e=Math.max(n.id,e)}),this.connects.each(function(t,n){e=Math.max(n.id,e)}),e+1},jmEditor.prototype.isEnabled=function(e){return"undefined"!=typeof e&&(this.__enabled=e),this.__enabled},jmEditor.prototype.initEvents=function(){var e=this;this.graph.bind("mousedown",function(t){var n=e;return 0==t.button||1==t.button?(n.selectAll(!1),n.selecting=!0,n.selectRect.position({x:t.position.offsetX,y:t.position.offsetY}),n.selectRect.width(1),n.selectRect.height(1),n.selectRect.visible=!0,!1):void 0}),this.graph.bind("mousemove",function(t){var n=e;if(n.selecting){var i=n.selectRect.position(),o=t.position.offsetX-i.x,s=t.position.offsetY-i.y;return n.selectRect.width(o),n.selectRect.height(s),n.graph.refresh(),!1}}),jmUtils.bindEvent(document,"mousemove",function(t){var n=e;if(n.currentComponent){t=t||event;var i=jmUtils.getEventPosition(t||event),o=i.pageX-n.currentComponent.evtX,s=i.pageY-n.currentComponent.evtY;return n.currentComponent.left+=o,n.currentComponent.top+=s,n.currentComponent.img.style.left=n.currentComponent.left+"px",n.currentComponent.img.style.top=n.currentComponent.top+"px",n.currentComponent.evtX=i.pageX,n.currentComponent.evtY=i.pageY,!1}}),jmUtils.bindEvent(document,"mouseup",function(t){var n=e;if(n.currentComponent){t=t||event;var i=jmUtils.getElementPosition(n.graph.canvas),o=jmUtils.getEventPosition(t);if(o.pageX>=i.left&&o.pageX<=i.left+n.graph.canvas.width&&o.pageY>=i.top&&o.pageY<=i.top+n.graph.canvas.height){var s=n.currentComponent.img.getAttribute("data-component"),r=n.components[s],c=o.pageX-i.left,a=o.pageY-i.top;r.width&&(c-=r.width/2),r.height&&(a-=r.height/2),"function"==typeof r?r.call(n,{x:c,y:a}):(r=jmUtils.clone(r),r.position={x:c,y:a},n.addCell(r)),n.save(),n.graph.refresh()}return document.body.removeChild(n.currentComponent.img),n.currentComponent=null,!1}if(n.selecting){n.selectRect.visible=!1,n.selecting=!1;var h=n.selectRect.position(),l={x:h.x+n.selectRect.width(),y:h.y+n.selectRect.height()};n.cells.each(function(e,t){var n=t.position?t.position():t.center?t.center():{x:0,y:0};n.x>=Math.min(h.x,l.x)&&n.x<=Math.max(h.x,l.x)&&n.y>=Math.min(h.y,l.y)&&n.y<=Math.max(h.y,l.y)&&t.select(!0)}),n.graph.refresh()}}),this.graph.bind("keydown",function(t){var n=t.keyCode,i=e;switch(n){case 46:if(i.isEnabled()){var o=!1,s=i.getSelectedCells();if(s&&s.length>0&&(i.remove(s),o=!0),i.connects.each(function(e,t){t.selected&&(t.remove(),o=!0)},!0),o)return i.graph.refresh(),i.save(),!1}break;case 97:case 65:if(t.ctrlKey)return i.selectAll(!0),i.emit("select",i,!0),!1;break;case 37:if(i.movable){var s=i.getSelectedCells();return i.moveCells(s,-1,0),!1}break;case 38:if(i.movable){var s=i.getSelectedCells();return i.moveCells(s,0,-1),!1}break;case 39:if(i.movable){var s=i.getSelectedCells();return i.moveCells(s,1,0),!1}break;case 40:if(i.movable){var s=i.getSelectedCells();return i.moveCells(s,0,1),!1}}})},jmEditor.prototype.selectAll=function(e,t){this.cells.each(function(n,i){t&&i.id==t||i.select(e)}),this.connects.each(function(t,n){n.select(1==e)})},jmEditor.prototype.getCell=function(e){return this.cells.get(function(t){return t.id==e})},jmEditor.prototype.getCells=function(){return this.cells.items},jmEditor.prototype.getSelectedCells=function(){var e=[];return this.cells.each(function(t,n){n.selected&&e.push(n)}),e},jmEditor.prototype.getSelectedConnects=function(){var e=[];return this.connects.each(function(t,n){n.selected&&e.push(n)}),e},jmEditor.prototype.moveCells=function(e,t,n){if(jmUtils.isArray(e))for(var i=e.length-1;i>=0;i--)e[i].offset(t,n);else e&&e.offset(t,n);this.graph.refresh()},jmEditor.prototype.remove=function(e){if(jmUtils.isArray(e))for(var t=e.length-1;t>=0;t--)e[t].remove();else e&&e.remove();this.graph.refresh()},jmEditor.prototype.clear=function(){this.remove(this.cells.items)},jmEditor.prototype.regComponent=function(e,t){if(this.components||(this.components=[]),this.components.push(t),"string"==typeof e){var n=document.createElement("img");n.src=e,e=n}e.setAttribute("data-component",this.components.length-1);var i=this;return jmUtils.bindEvent(e,"mousedown",function(e){var t=i;e=e||event;var n=e.target||e.srcElement,o=jmUtils.getElementPosition(n);if(n.getAttribute("data-component")||0==n.children.length&&(n=n.parentElement),t.currentComponent={},t.currentComponent.img=document.createElement("img"),t.currentComponent.img.setAttribute("data-component",n.getAttribute("data-component")),"IMG"!==n.tagName)for(var s in n.children){var r=n.children[s];if("IMG"===r.tagName){n=r;break}}t.currentComponent.img.src=n.src,t.currentComponent.img.width=n.width,t.currentComponent.img.height=n.height,t.currentComponent.img.style.position="absolute",t.currentComponent.left=o.left,t.currentComponent.top=o.top,t.currentComponent.img.style.left=o.left+"px",t.currentComponent.img.style.top=o.top+"px",window.document.body.appendChild(t.currentComponent.img);var c=jmUtils.getEventPosition(e||event);return t.currentComponent.evtX=c.pageX,t.currentComponent.evtY=c.pageY,e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1,!1}),e},jmEditor.prototype.regStyle=function(e,t){this.styles[e]=t},jmEditor.prototype.save=function(){this.isEnabled()&&(this.caches||(this.caches=[]),this.cacheIndex<this.caches.length-1&&(this.caches=this.caches.slice(0,this.cacheIndex)),this.caches.length>10&&(this.caches=this.caches.slice(this.caches.length-10)),this.caches.push(this.toJSON()),this.cacheIndex=this.caches.length-1)},jmEditor.prototype.undo=function(){if(this.isEnabled()&&this.caches&&this.caches.length>0&&this.cacheIndex>0){"undefined"==typeof this.cacheIndex&&(this.cacheIndex=this.cacheIndex||this.caches.length-1),this.cacheIndex=this.cacheIndex>0?--this.cacheIndex:0;var e=this.caches[this.cacheIndex];this.fromJSON(e,!0)}},jmEditor.prototype.redo=function(){if(this.isEnabled()&&void 0!==this.cacheIndex&&this.cacheIndex<this.caches.length-1&&this.caches&&this.caches.length>0&&(this.cacheIndex=this.cacheIndex+1,this.cacheIndex<this.caches.length)){var e=this.caches[this.cacheIndex];this.fromJSON(e,!0)}},jmEditor.prototype.align=function(e){var t=this.getSelectedCells();if(!(t.length<2)){var n;for(var i in t){var o=t[i],s=o.position();(!n||n.y>s.y)&&(n=o)}switch(e){case"left":for(var i in t){var o=t[i];"left"==e&&o.offset(n.position().x-o.position().x,0,!1)}break;case"right":for(var i in t){var o=t[i],r=n.position().x+n.width();o.offset(r-o.width()-o.position().x,0,!1)}break;case"center":for(var i in t){var o=t[i],c=n.position().y+n.height()/2;o.offset(0,c-o.height()/2-o.position().y,!1)}break;case"top":for(var i in t){var o=t[i];o.offset(0,n.position().y-o.position().y,!1)}break;case"bottom":for(var i in t){var o=t[i],a=n.position().y+n.height();o.offset(0,a-o.height()-o.position().y,!1)}break;case"middle":for(var i in t){var o=t[i],h=n.position().x+n.width()/2;o.offset(h-o.width()/2-o.position().x,0,!1)}}this.save(),this.graph.refresh()}},jmEditor.prototype.resize=function(e){var t=0,n=0;if(e){var i=e.position();t=i.x+e.width(),n=i.y+e.height()}else this.cells.each(function(e,i){var o=i.position(),s=o.x+i.width(),r=o.y+i.height();t=Math.max(s,t),n=Math.max(r,n)});(t>this.graph.canvas.width||n>this.graph.canvas.height)&&this.graph.redraw(Math.max(t,this.graph.canvas.width)+10,Math.max(n,this.graph.canvas.height)+10)},jmEditor.prototype.execute=function(e){switch(e){case"zoomOut":this.graph.zoomOut();break;case"zoomIn":this.graph.zoomIn();break;case"zoomActual":this.graph.zoomActual();break;case"undo":this.undo();break;case"redo":this.redo()}},jmEditor.prototype.toImage=function(){return this.graph.toDataURL()},jmEditor.prototype.toJSON=function(){var e={cells:[],toString:function(){return JSON.stringify(this)}};return this.cells.each(function(t,n){var i={outs:[]};i.id=n.id,i.position=n.position(),i.width=n.width(),i.height=n.height(),i.style=n.styleName||n.style,i.value=n.value(),n.connects&&n.connects.each(function(e,t){t.from==n&&i.outs.push({id:t.id,to:t.to.id,value:t.value(),from:n.id})}),e.cells.push(i)}),e},jmEditor.prototype.fromJSON=function(e,t){if(e){if("string"==typeof e&&(e=JSON.parse(e)),this.clear(),e.cells){for(var n in e.cells){var i=e.cells[n];this.addCell(i)}for(var n in e.cells){var i=e.cells[n];if(i.outs){var o=this.getCell(i.id);if(!o)continue;for(var s in i.outs){var r=i.outs[s];if(r.to){var c=this.getCell(r.to);c&&o.connect(c,r.id,r.value)}}}}this.resize(),this.graph.refresh()}t!==!0&&this.save()}};
function jmGraph(t,e,i){if(this.type="jmGraph",this.mode="canvas","string"==typeof t&&(t=document.getElementById(t)),"canvas"==this.mode){if("CANVAS"!=t.tagName){var a=document.createElement("canvas");t.appendChild(a),a.width=t.clientWidth,a.height=t.clientHeight,t=a}this.canvas=t,e&&this.width(e),i&&this.height(i),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.init_(document),this.context=t.getContext("2d")}else this.context=new jmSVG(t,e,i),this.canvas=this.context.paper;this.initializing(this.context),function(){"undefined"!=typeof jmLine&&this.registerShape("line",jmLine),"undefined"!=typeof jmPath&&this.registerShape("path",jmPath),"undefined"!=typeof jmRect&&this.registerShape("rect",jmRect),"undefined"!=typeof jmCircle&&this.registerShape("circle",jmCircle),"undefined"!=typeof jmArc&&this.registerShape("arc",jmArc),"undefined"!=typeof jmHArc&&this.registerShape("harc",jmHArc),"undefined"!=typeof jmPrismatic&&this.registerShape("prismatic",jmPrismatic),"undefined"!=typeof jmLabel&&this.registerShape("label",jmLabel),"undefined"!=typeof jmImage&&(this.registerShape("image",jmImage),this.registerShape("img",jmImage)),"undefined"!=typeof jmBezier&&this.registerShape("bezier",jmBezier),"undefined"!=typeof jmArraw&&this.registerShape("arraw",jmArraw),"undefined"!=typeof jmArrawLine&&this.registerShape("arrawline",jmArrawLine),"undefined"!=typeof jmResize&&this.registerShape("resize",jmResize),"undefined"!=typeof jmTooltip&&this.registerShape("tooltip",jmTooltip)}.call(this),this.eventHandler=new jmEvents(this,this.canvas.canvas||this.canvas)}jmUtils.extend(jmGraph,jmControl),jmGraph.prototype.registerShape=function(t,e){t="jmGraph.shapes."+t,jmUtils.cache.get(t)||jmUtils.cache.set(t,e)},jmGraph.prototype.createShape=function(t,e){t="jmGraph.shapes."+t;var i=jmUtils.cache.get(t);if(i){e||(e={}),e.mode=this.mode;var a=new i(this,e);return a}},jmGraph.prototype.isSupportedBrowser=function(){var t=jmUtils.browser();return!t.msie||t.ver>8},jmGraph.prototype.createShadow=function(t,e,i,a){var h=new jmShadow(t,e,i,a);return h},jmGraph.prototype.createLinearGradient=function(t,e,i,a){var h=new jmGradient({type:"linear",x1:t,y1:e,x2:i,y2:a});return h},jmGraph.prototype.createRadialGradient=function(t,e,i,a,h,r){var n=new jmGradient({type:"radial",x1:t,y1:e,r1:i,x2:a,y2:h,r2:r});return n},jmGraph.prototype.refresh=function(){this.animate(function(){return!1},100,"jmgraph_refresh")},jmGraph.prototype.redraw=function(t,e){this.clear(t,e),this.paint()},jmGraph.prototype.clear=function(t,e){t&&e?(this.canvas.width=t,this.canvas.height=e,this.scaleSize&&this.context.scale&&this.context.scale(this.scaleSize.x,this.scaleSize.y)):(t=this.canvas.width,e=this.canvas.height,this.scaleSize&&(t/=this.scaleSize.x,e/=this.scaleSize.y)),this.context.clearRect&&this.context.clearRect(0,0,t,e)},jmGraph.prototype.css=function(t,e){this.canvas&&(this.canvas.style[t]=e)},jmGraph.prototype.createPath=function(t,e){var i=this.createShape("path",{points:t,style:e});return i},jmGraph.prototype.createLine=function(t,e,i){var a=this.createShape("line",{start:t,end:e,style:i});return a},jmGraph.prototype.getBounds=function(){var t={};return t.left=0,t.top=0,t.right="function"==typeof this.canvas.width?this.canvas.width():this.canvas.width,t.bottom="function"==typeof this.canvas.height?this.canvas.height():this.canvas.height,t.width=t.right,t.height=t.bottom,t},jmGraph.prototype.getPosition=function(){var t=jmUtils.getElementPosition(this.canvas.canvas||this.canvas);return t.width=this.canvas.width,t.height=this.canvas.height,t.right=t.left+t.width,t.bottom=t.top+t.height,t},jmGraph.prototype.checkPoint=function(t){var e=this.getPosition();return t.pageX>e.right||t.pageX<e.left?!1:t.pageY>e.bottom||t.pageY<e.top?!1:!0},jmGraph.prototype.zoomOut=function(){this.scale(.9,.9)},jmGraph.prototype.zoomIn=function(){this.scale(1.1,1.1)},jmGraph.prototype.zoomActual=function(){this.scaleSize?this.scale(1/this.scaleSize.x,1/this.scaleSize.y):this.scale(1,1)},jmGraph.prototype.width=function(t){return"undefined"!=typeof t&&(this.canvas.width=t),this.canvas.width},jmGraph.prototype.height=function(t){return"undefined"!=typeof t&&(this.canvas.height=t),this.canvas.height},jmGraph.prototype.scale=function(t,e){this.normalSize||(this.normalSize={width:this.canvas.width,height:this.canvas.height}),this.context.scale(t,e),this.scaleSize=this.scaleSize?{x:t*this.scaleSize.x,y:e*this.scaleSize.y}:{x:t,y:e},this.refresh()},jmGraph.prototype.toDataURL=function(){var t=this.canvas.toDataURL?this.canvas.toDataURL():"";return t};