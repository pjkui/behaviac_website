function jmGradient(a){if(a)for(var b in a)this[b]=a[b];this.stops=new jmUtils.list}function jmShadow(a,b,c,d){this.x=a,this.y=b,this.blur=c,this.color=d,this.toGlow=function(){return{width:this.blur,offsetx:this.x,offsety:this.y,color:this.color}}}function jmObject(){}function jmEvents(a,b){function c(a,b){this.container=a,this.target=b||a,this.init=function(){var b=this.target;b.oncontextmenu=function(){return!1},jmUtils.bindEvent(this.target,"mousedown",function(b){b=b||event;a.raiseEvent("mousedown",b);return b.preventDefault&&b.preventDefault(),!1}),jmUtils.bindEvent(window.document,"touchstart",function(b){b=b||event,a.raiseEvent("touchstart",b)}),jmUtils.bindEvent(window.document,"mousemove",function(c){c=c||event;var d=c.target||c.srcElement;if(d==b){a.raiseEvent("mousemove",c);return c.preventDefault&&c.preventDefault(),!1}}),jmUtils.bindEvent(window.document,"touchmove",function(b){b=b||event,a.raiseEvent("touchmove",b)}),jmUtils.bindEvent(this.target,"mouseover",function(b){b=b||event,a.raiseEvent("mouseover",b)}),jmUtils.bindEvent(this.target,"mouseleave",function(b){b=b||event,a.raiseEvent("mouseleave",b)}),jmUtils.bindEvent(this.target,"mouseout",function(b){b=b||event,a.raiseEvent("mouseout",b)}),jmUtils.bindEvent(window.document,"mouseup",function(b){b=b||event;var c=a.raiseEvent("mouseup",b);return c===!1?(b.preventDefault&&b.preventDefault(),!1):void 0}),jmUtils.bindEvent(window.document,"touchend",function(b){return b=b||event,a.raiseEvent("touchend",b),!1}),jmUtils.bindEvent(this.target,"dblclick",function(b){b=b||event,a.raiseEvent("dblclick",b)}),jmUtils.bindEvent(this.target,"click",function(b){b=b||event,a.raiseEvent("click",b)}),jmUtils.bindEvent(document,"resize",function(b){return b=b||event,a.raiseEvent("resize",b)})},this.init()}function d(a,b){function c(a){var b=a.srcElement||a.target;return!b||"INPUT"!=b.tagName&&"TEXTAREA"!=b.tagName&&"ANCHOR"!=b.tagName&&"FORM"!=b.tagName&&"FILE"!=b.tagName&&"IMG"!=b.tagName&&"HIDDEN"!=b.tagName&&"RADIO"!=b.tagName&&"TEXT"!=b.tagName?!0:!1}this.container=a,this.target=b||a,this.init=function(){jmUtils.bindEvent(document,"keypress",function(b){if(b=b||event,c(b)){var d=a.raiseEvent("keypress",b);return d===!1&&b.preventDefault&&b.preventDefault(),d}}),jmUtils.bindEvent(document,"keydown",function(b){if(b=b||event,c(b)){var d=a.raiseEvent("keydown",b);return d===!1&&b.preventDefault&&b.preventDefault(),d}}),jmUtils.bindEvent(document,"keyup",function(b){if(b=b||event,c(b)){var d=a.raiseEvent("keyup",b);return d===!1&&b.preventDefault&&b.preventDefault(),d}})},this.init()}this.mouseHandler=new c(a,b),this.keyHandler=new d(a,b)}function jmControl(){}function runEventHandle(a,b){var c=this.getEvent(a);if(c){var d=this;c.each(function(a,c){!1===c.call(d,b)&&(b.cancel=!0)})}return b.cancel}function jmShape(a){this.type="jmShape",this.graph=a,this.initializing(a.context,style)}function jmPath(a,b){this.type="jmPath";var c=b&&b.style?b.style:null;this.graph=a,this.points=b&&b.points?b.points:[],this.initializing(a.context,c)}function jmLine(a,b){b||(b={}),this.type="jmLine",this.points=b.points||[];var c=b.style||{};this.graph=a,this.start(b.start||{x:0,y:0}),this.end(b.end||{x:0,y:0}),c.lineType=c.lineType||"solid",c.dashLength=c.dashLength||4,this.initializing(a.context,c)}function jmCircle(a,b){b||(b={}),this.type="jmCircle",this.points=b.points||[];var c=b.style||{};this.graph=a,this.center(b.center||{x:0,y:0}),this.width(b.width||0),this.height(b.height||0),this.radius(b.radius||0),this.initializing(a.context,c)}function jmArc(a,b){b||(b={}),this.points=b.points||[];var c=b.style||{};this.type="jmArc",this.graph=a,this.center(b.center||{x:0,y:0}),this.radius(b.radius||0),this.startAngle(b.start||0),this.endAngle(b.end||2*Math.PI),this.width(b.width||0),this.height(b.height||0),this.anticlockwise(b.anticlockwise||0),this.initializing(a.context,c)}function jmHArc(a,b){b||(b={}),this.type="jmHArc",this.points=b.points||[];var c=b.style||{};this.graph=a,this.center(b.center||{x:0,y:0}),this.minRadius(b.minRadius||c.minRadius||0),this.maxRadius(b.maxRadius||c.maxRadius||0),this.startAngle(b.start||0),this.endAngle(b.end||2*Math.PI),this.width(b.width||0),this.height(b.height||0),this.anticlockwise(b.anticlockwise||0),this.initializing(a.context,c)}function jmPrismatic(a,b){b||(b={}),this.type="jmPrismatic",this.points=b.points||[];var c=b.style||{};this.graph=a,this.center(b.center||{x:0,y:0}),this.width(b.width||0),this.height(b.height||0),this.initializing(a.context,c)}function jmFusiformis(a,b){b||(b={}),this.type="jmFusiformis",this.points=b.points||[];var c=b.style||{};this.graph=a,this.center(b.center||{x:0,y:0}),this.width(b.width||0),this.height(b.height||0),this.initializing(a.context,c)}function jmBezier(a,b){b||(b={}),this.type="jmBezier",this.points=b.points||[];var c=b.style||{};this.graph=a,this.cpoints(this.points),this.initializing(a.context,c)}function jmRect(a,b){b||(b={}),this.type="jmRect",this.points=b.points||[];var c=b.style||{};c.close=!0,this.graph=a,this.position(b.position||{x:0,y:0}),this.width(b.width||0),this.height(b.height||0),this.radius(b.radius||c.radius||0),this.initializing(a.context,c)}function jmSequence(a,b){b||(b={}),this.type="jmSequence",this.points=b.points||[];var c=b.style||{};c.close=!0,this.graph=a,this.position(b.position||{x:0,y:0}),this.width(b.width||0),this.height(b.height||0),this.radius(b.radius||c.radius||0),this.initializing(a.context,c)}function jmArraw(a,b){b||(b={}),this.points=b.points||[];var c=b.style||{};this.type="jmArraw",c.lineJoin="miter",c.lineCap="square",this.graph=a,this.angle(b.angle||0),this.start(b.start||0),this.end(b.end||0),this.offsetX(b.offsetX||5),this.offsetY(b.offsetY||8),this.initializing(a.context,c)}function jmLabel(a,b){b||(b={});var c=b.style||{};c.font=c.font||"15px Arial",this.type="jmLabel",c.textAlign=c.textAlign||"left",c.textBaseline=c.textBaseline||"middle",this.graph=a,this.value=b.value,this.position(b.position||{x:0,y:0}),this.width(b.width||0),this.height(b.height||0),"canvas"!=a.mode&&(this.svgShape=a.context.create("text",this)),this.initializing(a.context,c)}function jmImage(a,b){var c=b&&b.style?b.style:{};this.graph=a,this.width(b.width),this.height(b.height),this.type="jmImage",this.position(b.position||{x:0,y:0}),this.sourceWidth(b.swidth),this.sourceHeight(b.sheight),this.sourcePosition(b.sposition),this.image(b.image||c.image),this.initializing(a.context,c)}function jmResize(a,b){this.params=b||{};var c=b.style||{};this.type="jmResize",this.enabled=b.enabled===!1?!1:!0,this.graph=a,this.points=b.points||[],this.position(b.position||{x:0,y:0}),this.width(b.width||0),this.height(b.height||0),this.rectSize(b.rectSize||10),this.initializing(a.context,c),this.init()}function jmArrawLine(a,b){b||(b={}),this.points=b.points||[];var c=b.style||{};c.lineJoin="miter",this.graph=a,this.type="jmArrawLine",this.start=b.start||(b.start={x:0,y:0}),this.end=b.end||(b.end={x:0,y:0}),this.initializing(a.context,c),this.line=a.createShape("line",b),this.arraw=a.createShape("arraw",b)}function jmTooltip(a,b){b||(b={});var c=b.style||{};c.font=c.font||"15px Arial",this.type="jmTooltip",this.graph=a,this.position(b.position||{x:0,y:0}),this.initializing(a.context,c),this.element=document.createElement("div"),this.element.className="jm-tooltip",this.element.style.position="absolute",this.element.style.display="none",this.value(b.value),document.body.appendChild(this.element)}function jmGraph(a,b,c){if(this.type="jmGraph",this.mode="canvas","string"==typeof a&&(a=document.getElementById(a)),"canvas"==this.mode){if("CANVAS"!=a.tagName){var d=document.createElement("canvas");a.appendChild(d),d.width=a.clientWidth,d.height=a.clientHeight,a=d}this.canvas=a,b&&this.width(b),c&&this.height(c),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.init_(document),this.context=a.getContext("2d")}else this.context=new jmSVG(a,b,c),this.canvas=this.context.paper;this.initializing(this.context),function(){"undefined"!=typeof jmLine&&this.registerShape("line",jmLine),"undefined"!=typeof jmPath&&this.registerShape("path",jmPath),"undefined"!=typeof jmRect&&this.registerShape("rect",jmRect),"undefined"!=typeof jmSequence&&this.registerShape("sequence",jmSequence),"undefined"!=typeof jmCircle&&this.registerShape("circle",jmCircle),"undefined"!=typeof jmArc&&this.registerShape("arc",jmArc),"undefined"!=typeof jmHArc&&this.registerShape("harc",jmHArc),"undefined"!=typeof jmPrismatic&&this.registerShape("prismatic",jmPrismatic),"undefined"!=typeof jmFusiformis&&this.registerShape("fusiformis",jmFusiformis),"undefined"!=typeof jmLabel&&this.registerShape("label",jmLabel),"undefined"!=typeof jmImage&&(this.registerShape("image",jmImage),this.registerShape("img",jmImage)),"undefined"!=typeof jmBezier&&this.registerShape("bezier",jmBezier),"undefined"!=typeof jmArraw&&this.registerShape("arraw",jmArraw),"undefined"!=typeof jmArrawLine&&this.registerShape("arrawline",jmArrawLine),"undefined"!=typeof jmResize&&this.registerShape("resize",jmResize),"undefined"!=typeof jmTooltip&&this.registerShape("tooltip",jmTooltip)}.call(this),this.eventHandler=new jmEvents(this,this.canvas.canvas||this.canvas)}function jmCell(a){if(this.option=a,this.type="jmCell",this.value(a.value||""),this.graph=a.graph,this.editor=a.editor,this.styleName=a.style,this.setStyle(this.styleName),a.position=a.position||{x:0,y:0},this.preConditions=[],this.postConditions=[],a.width?this.width(a.width):this.style.width&&(this.width(this.style.width),a.position.x-=this.style.width/2),a.height?this.height(a.height):this.style.height&&(this.height(this.style.height),a.position.y-=this.style.height/2),this.position(a.position),this.selected=!1,this.initializing(this.graph.context,this.style),"undefined"!=typeof a.resizable?this.resizable=a.resizable:"undefined"!=typeof this.style.resizable&&(this.resizable=this.style.resizable),"undefined"!=typeof a.connectable?this.connectable=a.connectable:"undefined"!=typeof this.style.connectable?this.connectable=this.style.connectable:this.connectable=this.editor.connectable,a.preConditions){var b=a.preConditions.length;if(b>0)for(var c=0;b>c;++c)this.addPrecondition(a.preConditions[c].value)}if(a.postConditions){var d=a.postConditions.length;if(d>0)for(var c=0;d>c;++c)this.addPostcondition(a.postConditions[c].value)}}function jmConnectLine(a,b){this.graph=a,this.editor=b.editor,this.id=b.id,this.from=b.from,this.to=b.to,this.selected=!1,this.points=b.points||[];var c=b.style||{stroke:this.editor.defaultStyle.connectLine.stroke,lineWidth:this.editor.defaultStyle.connectLine.lineWidth,zIndex:1};this.type="jmConnectLine",c.close=!1,this.initializing(a.context,c),b=jmUtils.extend({start:b.from.outPos2,end:b.to.inPos},b);var d=jmUtils.clone(b.style);d.fill=c.stroke,b.style=d,this.arraw=a.createShape("arraw",b),this.children.add(this.arraw);var e=this.style.fontStyle||this.editor.defaultStyle.font;this.label=this.graph.createShape("label",{style:e}),this.on("add",function(a){a.children.add(a.label)}),this.on("beginDraw",function(a){var b=a.bounds;a.label.width(b.width),a.label.height(b.height)}),this.selected=!1}function jmEditor(a){this.option=a,this.cells=new jmUtils.list,this.connects=new jmUtils.list,this.styles={},this.type="jmEditor",a&&"undefined"==typeof a.enabled&&(a.enabled=!0),this.isEnabled(a.enabled),this.connectable=a.connectable===!1?!1:!0,this.movable=a.movable===!1?!1:!0,a.container&&("string"==typeof a.container&&(a.container=document.getElementById(a.container)),"CANVAS"!=a.container.tagName?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.style.padding="0",this.container.style.margin="0",this.container.style.width="100%",this.container.style.height="100%",a.container.appendChild(this.container)):(this.container=a.container.parentElement,canvas=a.container),this.graph=new jmGraph(this.container,a.width,a.height),this.selectRect=this.graph.createShape("rect",{style:this.defaultStyle.selectRect}),this.selectRect.visible=!1,this.graph.children.add(this.selectRect),this.graph.registerShape("cellConnectLine",jmConnectLine),this.initEvents())}var jmUtils={version:"1.0.0"};jmUtils.extend=function(a,b){if("function"==typeof b){var c=function(){};c.prototype=b.prototype;var d=a.prototype;d&&d.constructor!=Object&&jmUtils.extend(c,d),a.prototype=new c,a.prototype.constructor=a,a.superClass=b}else{if("object"!=typeof b)throw new Error('fatal error:"Function.prototype.extend" expects a function or object');var e="function"==typeof a?a.prototype:a;for(var f in b)e[f]||(e[f]=b[f]);e._base=b}return a},jmUtils.clone=function(a){if(a&&"object"==typeof a){if(jmUtils.isType(a,jmUtils.list))return new jmUtils.list(a.items);if(jmUtils.isArray(a))return a.slice(0);var b={};b.constructor=a.constructor;for(var c in a)b[c]=jmUtils.clone(a[c]);return b}return a},jmUtils.clone=function(a,b){var c=Object.prototype.toString;if(!a&&"object"!=typeof a)return a;if(a.clone&&"[object Function]"==c.call(a.clone))return a.clone(b);if(a.nodeType&&"[object Function]"==c.call(a.cloneNode))return a.cloneNode(b);if("[object Date]"==c.call(a))return new Date(a.getTime());if("[object RegExp]"==c.call(a))return new RegExp(a);if("[object Function]"==c.call(a))return function(){a.apply(this,arguments)};var d,e;if("[object Array]"==c.call(a)){if(d=a.slice(),b)for(e=d.length;e--;)d[e]=clone(d[e],!0)}else{d=a.constructor?new a.constructor:{};for(var f in a)d[f]=b?clone(a[f],!0):a[f]}return d},jmUtils.apply=function(a,b){if("object"==typeof a&&"object"==typeof b)for(var c in a){var d=typeof a[c];"function"!=d&&("object"==d?(b[c]&&"object"==typeof b[c]||(b[c]={}),this.apply(a[c],b[c])):b[c]=a[c])}},jmUtils.list=function(){function a(a){this.items=[],a&&(jmUtils.isArray(a)?this.items=a.slice(0):this.items.push(a))}return a.prototype.add=function(a){if(a&&jmUtils.isArray(a)){for(var b in a)this.add(a[b]);return a}return"object"==typeof a&&this.contain(a)?a:(this.items.push(a),a)},a.prototype.remove=function(a){for(var b=this.items.length-1;b>=0;b--)this.items[b]==a&&this.removeAt(b)},a.prototype.removeAt=function(a){this.items.length>a&&this.items.splice(a,1)},a.prototype.contain=function(a){for(var b in this.items)if(this.items[b]==a)return!0;return!1},a.prototype.get=function(a){if("function"!=typeof a)return this.items[a];for(var b in this.items)if(a(this.items[b]))return this.items[b]},a.prototype.each=function(a,b){if(a&&"function"==typeof a)if(b)for(var c=this.items.length-1;c>=0;c--){var d=a.call(this,c,this.items[c]);if(d===!1)break}else for(var e=this.items.length,c=0;e>c;c++){var d=a.call(this,c,this.items[c]);if(d===!1)break}},a.prototype.sort=function(a){this.items.sort(a)},a.prototype.count=function(a){if(a&&"function"==typeof a){for(var b=0,c=this.items.length,d=0;c>d;d++)a(this.items[d])&&b++;return b}return this.items.length},a.prototype.clear=function(){for(var a=this.items.length-1;a>=0;a--)this.remove(this.items[a])},a}(),jmUtils.cache={items:{},add:function(a,b){return this.set(a,b),b},set:function(a,b){this.items[a]=b},get:function(a){return this.items[a]},remove:function(a){this.items[a]=null}},jmUtils.browser=function(){if(jmUtils.browserInfo)return jmUtils.browserInfo;if(jmUtils.browserInfo={agent:navigator.userAgent},/Mobile/i.test(jmUtils.browserInfo.agent)&&(jmUtils.browserInfo.mobile=!0),/iPad/i.test(jmUtils.browserInfo.agent)?jmUtils.browserInfo.iPad=!0:/iPhone/i.test(jmUtils.browserInfo.agent)?jmUtils.browserInfo.iPhone=!0:/Android/i.test(jmUtils.browserInfo.agent)&&(jmUtils.browserInfo.android=!0),/msie/i.test(jmUtils.browserInfo.agent)){jmUtils.browserInfo.msie=!0;var a=jmUtils.browserInfo.agent.match(/msie\s+\d+(\.\d+)*/i)[0];jmUtils.browserInfo.ver=a.match(/\d+(\.\d+)*/)[0]}else/Chrome/i.test(jmUtils.browserInfo.agent)?jmUtils.browserInfo.chrome=!0:/Safari/i.test(jmUtils.browserInfo.agent)?jmUtils.browserInfo.safari=!0:/Firefox/i.test(jmUtils.browserInfo.agent)&&(jmUtils.browserInfo.firefox=!0);return jmUtils.browserInfo},jmUtils.isSupportedBrowser=function(){var a=jmUtils.browser();return!a.msie||a.ver>8},jmUtils.checkSupportedMode=function(){var a=document.createElement("canvas");if(a&&a.getContext)return"canvas";if(document.createElementNS)return"svg";if(this.browser().msie&&this.browser().ver<9)return"vml";throw"not supported browser"},jmUtils.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},jmUtils.isDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)},jmUtils.loadImg=function(a,b){if(jmUtils.isArray(a)||"object"==typeof a){var c=0,d=0;for(var e in a)c++,b?jmUtils.loadImg(a[e],function(){d++,d==c&&b()}):jmUtils.loadImg(a[e])}else if("string"==typeof a){var f=document.createElement("img");b&&(f.onload=function(){b()},f.onerror=function(){b()}),f.src=a}else b()},jmUtils.require=function(a,b){function c(c){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||b&&b(a)}if(jmUtils.isArray(a)){var d=a.length;for(var e in a)jmUtils.require(a[e],function(a,c){c?b&&b(a,c):(d--,0==d&&b&&b(d))})}else{var f=document.getElementsByTagName("script");for(var e in f)if(f[e].src===a)return void(b&&b(a));f=document.createElement("script"),f.type="text/javascript",f.charset="utf-8",f.src=a;var g=document.getElementsByTagName("head")[0];g.appendChild(f),b&&(f.readyState?f.onreadystatechange=c:f.onload=c),f.onerror=function(){g.removeChild(f),b&&b(a,"load faild")}}},jmUtils.bindEvent=function(a,b,c){if(!b||-1==b.indexOf(" "))return a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener?(a.addEventListener(b,c),!0):!1;for(var d=b.split(" "),e=0;e<d.length;e++)jmUtils.bindEvent(a,d[e],c)},jmUtils.removeEvent=function(a,b,c){return a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?(a.detachEvent("on"+b,c),!0):void(a["on"+b]=null)},jmUtils.getElementPosition=function(a){if(a){var b={top:0,left:0};if(a.offsetParent)for(;a.offsetParent;)b.top+=a.offsetTop,b.left+=a.offsetLeft,a=a.offsetParent;else a.x?b.left+=a.x:a.x&&(b.top+=a.y);return b}},jmUtils.getEventPosition=function(a,b){a=a||event;var c=a.changedTouches||a.targetTouches||a.touches;c&&(a=c[0]);var d=a.pageX||a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft),e=a.pageY||a.clientY+(document.documentElement.scrollTop||document.body.scrollTop),f=a.offsetX,g=a.offsetY;if("undefined"==typeof f&&"undefined"==typeof g){var h=jmUtils.getElementPosition(a.target||a.srcElement);f=d-h.left,g=e-h.top}return b&&(b.x&&(f/=b.x),b.y&&(g/=b.y)),{pageX:d,pageY:e,clientX:a.clientX,clientY:a.clientY,offsetX:f,offsetY:g,layerX:a.layerX,layerY:a.layerY,screenX:a.screenX,screenY:a.screenY,x:f,y:g}},jmUtils.isType=function(a,b){return a&&"object"==typeof a&&a.constructor===b?!0:!1},jmUtils.pointInPolygon=function(a,b,c){c=c||1,c/=2;var d,e,f=b.length,g=!1,h=!0;if(!b||0==f)return 0;if(1==f)return Math.abs(b[0].x-a.x)<=c&&Math.abs(b[0].y-a.y)<=c;if(2==f){if(Math.min(b[0].x,b[1].x)-a.x>c||a.x-Math.max(b[0].x,b[1].x)>c)return 0;if(Math.min(b[0].y,b[1].y)-a.y>c||a.y-Math.max(b[0].y,b[1].y)>c)return 0;if(b[0].x==b[1].x)return Math.abs(b[0].x-a.x)<=c&&(a.y-b[0].y)*(a.y-b[1].y)<=0?1:0;if(b[0].y==b[1].y)return Math.abs(b[0].y-a.y)<=c&&(a.x-b[0].x)*(a.x-b[1].x)<=0?1:0;if(Math.abs(b[0].x-a.x)<c&&Math.abs(b[0].y-a.y)<c)return 1;if(Math.abs(b[1].x-a.x)<c&&Math.abs(b[1].y-a.y)<c)return 1;if(a.y!=b[0].y&&a.y!=b[1].y){var i=(b[1].x-b[0].x)/(b[1].y-b[0].y)*(a.y-b[0].y),j=(a.y-b[0].y)/Math.sqrt(i*i+(a.y-b[0].y)*(a.y-b[0].y)),k=j*(a.x-b[0].x-i);return Math.abs(k)<=c?1:0}return 0}for(d=0;f>d;++d)if(b[d].x==a.x&&b[d].y==a.y)return 1;for(a=jmUtils.clone(a);h;)for(h=!1,g=!1,d=0,e=f-1;f>d;e=d++)if(b[d].y<a.y&&a.y<b[e].y||b[e].y<a.y&&a.y<b[d].y){if(a.x<=b[d].x||a.x<=b[e].x){var l=(a.y-b[d].y)*(b[e].x-b[d].x)/(b[e].y-b[d].y)+b[d].x;if(a.x<l)g=!g;else if(a.x==l)return 1}}else if(a.y==b[d].y){if(a.x<b[d].x){b[d].y>b[e].y?--a.y:++a.y,h=!0;break}}else if(b[d].y==b[e].y&&a.y==b[d].y&&(b[d].x<a.x&&a.x<b[e].x||b[e].x<a.x&&a.x<b[d].x)){g=!0;break}return g?2:0},jmUtils.checkOutSide=function(a,b,c){var d={left:0,right:0,top:0,bottom:0};return c.x<0?d.left=b.left+c.x-a.left:c.x>0&&(d.right=b.right+c.x-a.right),c.y<0?d.top=b.top+c.y-a.top:c.y>0&&(d.bottom=b.bottom+c.y-a.bottom),d},jmUtils.guid=function(){var a=(new Date).getTime();return a},jmUtils.trimStart=function(a,b){if(b=b||" ",a&&a.length>0){var c=a[0];if(c===b||b.indexOf(c)>=0)return a=a.substring(1),jmUtils.trimStart(a,b)}return a},jmUtils.trimEnd=function(a,b){if(b=b||" ",a&&a.length>0){var c=a[a.length-1];if(c===b||b.indexOf(c)>=0)return a=a.substring(0,a.length-1),jmUtils.trimStart(a,b)}return a},jmUtils.trim=function(a,b){return jmUtils.trimEnd(jmUtils.trimStart(a,b),b)},jmUtils.checkPercent=function(a){return"string"==typeof a&&(a=jmUtils.trim(a),"%"==a[a.length-1])?a:void 0},jmUtils.percentToNumber=function(a){if("string"==typeof a){var b=jmUtils.checkPercent(a);b&&(a=jmUtils.trim(b,"%"),a/=100)}return a},jmUtils.indexOf=function(a,b){if(jmUtils.isArray(b)){for(var c=0;c<b.length;c++)if(b[c]==a)return c}else if("string"==typeof b)return b.indexOf(a);return-1},jmUtils.parseXML=function(a){var b;if(DOMParser){var c=new DOMParser;b=c.parseFromString(a,"text/xml")}else{if(!window.ActiveXObject)return null;b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a)}return b},jmUtils.xmlToJSON=function(a){function b(a,c){if(a&&a.childNodes&&a.childNodes.length>0)for(var d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];if(1==e.nodeType){var f=e.name||e.nodeName||e.tagName;if(f){var g={children:[],attributes:{}};if(e.attributes)for(var h in e.attributes){var i=e.attributes[h],j=i.name||i.nodeName;j&&(g.attributes[j]=jmUtils.trim(i.value||e.nodeValue||i.textContent))}g.name=f,g.value=jmUtils.trim(e.value||e.nodeValue||e.textContent),c.children.push(g),b(e,g)}else c.value=jmUtils.trim(e.value||e.nodeValue||e.textContent),b(e,c)}}}if(!a)return null;"string"==typeof a&&(a=jmUtils.parseXML(a));var c={children:[]};return c.version=a.xmlVersion,c.title=a.title,b(a,c),c},jmUtils.hexToNumber=function(a){if("string"!=typeof a)return a;a=a.toLowerCase();for(var b="0123456789abcdef",c=0,d=a.length,e=d-1;e>=0;e--){var f=Number(b.indexOf(a[e]));if(0!=f){for(var g=d-e,h=1,i=0;g>i;i++)h*=16;c+=f*h}}return c},jmUtils.numberToHex=function(a){for(var b="0123456789abcdef",c="";a>0;){var d=a%16;c=b[d]+c,a=Math.floor(a/16)}return c},jmUtils.toColor=function(a,b,c,d){if("string"==typeof a){if(a.indexOf("rgb")>=0){a=this.trim(a,"rgba()) ");var e=a.split(",");a=e[0],b=e[1],c=e[2],void 0==d&&e.length>3&&(d=e[3])}else a.length<6?(c=a.substring(a.length-1,1),b=a.substring(a.length-2,1),a=a.substring(a.length-3,1),c+=""+c,b+=""+b,a+=""+a,a=this.hexToNumber(a),b=this.hexToNumber(b),c=this.hexToNumber(c)):(c=a.substring(a.length-2,2),b=a.substring(a.length-4,2),a.length>7&&(d=a.substring(a.length-8,2),d=this.hexToNumber(d)/255),a=a.substring(a.length-6,2),a=this.hexToNumber(a),b=this.hexToNumber(b),c=this.hexToNumber(c));return d?"rgba("+a+","+b+","+c+","+d+")":"rgb("+a+","+b+","+c+")"}return a=this.numberToHex(a),a=1==a.length?"0"+a:a,b=this.numberToHex(b),b=1==b.length?"0"+b:b,c=this.numberToHex(c),c=1==c.length?"0"+c:c,"#"+a+b+c},jmUtils.parseDate=function(a){if(jmUtils.isDate(a))return a;if("number"==typeof a)return new Date(a);var b=(a+",0,0,0").match(/\d+/g);return b[5]?new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5]):new Date(a)},jmUtils.formatDate=function(a,b){a=this.parseDate(a||new Date),b=b||"yyyy-MM-dd HH:mm:ss";var c=b.replace("yyyy",a.getFullYear().toString()).replace("MM",(a.getMonth()<9?"0":"")+(a.getMonth()+1).toString()).replace("dd",(a.getDate()<9?"0":"")+a.getDate().toString()).replace("HH",(a.getHours()<9?"0":"")+a.getHours().toString()).replace("mm",(a.getMinutes()<9?"0":"")+a.getMinutes().toString()).replace("ss",(a.getSeconds()<9?"0":"")+a.getSeconds().toString());return c},jmGradient.prototype.addColorStop=jmGradient.prototype.addStop=function(a,b){this.stops.add({offset:a,color:b})},jmGradient.prototype.toGradient=function(a){var b,c=a.context||a,d=a.absoluteBounds?a.absoluteBounds:a.getAbsoluteBounds(),e=this.x1,f=this.y1,g=this.x2,h=this.y2,i=a.getLocation(),j=0;if(i.radius&&(j=2*i.radius),j||(j=Math.min(i.width,i.height)),jmUtils.checkPercent(e)&&(e=jmUtils.percentToNumber(e)*(i.width||j)),jmUtils.checkPercent(g)&&(g=jmUtils.percentToNumber(g)*(i.width||j)),jmUtils.checkPercent(f)&&(f=jmUtils.percentToNumber(f)*(i.height||j)),jmUtils.checkPercent(h)&&(h=jmUtils.percentToNumber(h)*(i.height||j)),"linear"===this.type)"canvas"==a.mode?b=c.createLinearGradient(e+d.left,f+d.top,g+d.left,h+d.top):(b=Raphael.deg(Math.atan2(h-f,g-e))+"-",this.stops.each(function(a,c){b+=c.color+":"+Math.floor(100*c.offset)+"-"}),b=jmUtils.trimEnd(b,"-"));else if("radial"===this.type){var k=this.r1,l=this.r2;jmUtils.checkPercent(k)&&(k=jmUtils.percentToNumber(k),k=j*k),jmUtils.checkPercent(l)&&(l=jmUtils.percentToNumber(l),l=j*l),"canvas"==a.mode?b=c.createRadialGradient(e+d.left,f+d.top,k,g+d.left,h+d.top,l):(b="r(",this.stops.each(function(a,c){b+=c.offset+","}),b=jmUtils.trimEnd(b,",")+")",this.stops.each(function(a,c){b+=c.color+"-"}),b=jmUtils.trimEnd(b,"-"))}return"canvas"==a.mode&&this.stops.each(function(a,c){b.addColorStop(c.offset,c.color)}),b},jmGradient.prototype.toString=function(){},jmObject.prototype.is=function(a){return"string"==typeof a?this.type==a:this instanceof a},jmObject.prototype.animate=function(a,b){if(this.is("jmGraph")){if(a){this.animateHandles||(this.animateHandles=new jmUtils.list);var c=[];if(arguments.length>2)for(var d=2;d<arguments.length;d++)c.push(arguments[d]);this.animateHandles.add({millisec:b||20,handle:a,params:c})}if(this.animateHandles&&this.animateHandles.count()>0){var e=this;this.dispatcher=setTimeout(function(a){a=a||e;var b=!1,c=[],d=(new Date).getTime();a.animateHandles.each(function(e,f){try{if(f&&f.handle&&(!f.times||d-f.times>=f.millisec)){var g=f.handle.apply(a,f.params);g===!1&&c.push(f),f.times=d,b=!0}}catch(h){window.console&&window.console.info&&window.console.info(h.toString()),f&&c.push(f)}});for(var f in c)a.animateHandles.remove(c[f]);b&&a.redraw(),a.animate()},10,this)}}else{var f=this.findParent("jmGraph");f&&f.animate.apply(f,arguments)}};var jmProperty=function(){this.__properties={},this.__eventHandles={}};jmUtils.extend(jmProperty,jmObject),jmProperty.prototype.getValue=function(a){return this.__properties||(this.__properties={}),this.__properties[a]},jmProperty.prototype.setValue=function(a,b){if("undefined"!=typeof b){this.__properties||(this.__properties={});var c={oldValue:this.getValue(a),newValue:b};this.__properties[a]=b,this.emit("PropertyChange",a,c)}return this.getValue(a)},jmProperty.prototype.on=function(a,b){this.__eventHandles||(this.__eventHandles={});var c=this.__eventHandles[a];c||(c=this.__eventHandles[a]=[]);for(var d in c)if(c[d]===b)return;c.push(b)},jmProperty.prototype.emit=function(a){var b=this.__eventHandles?this.__eventHandles[a]:null;if(b){var c=[],d=arguments.length;if(d>1)for(var e=1;d>e;e++)c.push(arguments[e]);for(var e in b)b[e].apply(this,c)}},jmUtils.extend(jmControl,jmProperty),jmControl.prototype.initializing=function(a,b){this.context=a,this.style=b||{},this.visible=!0;var c=this.mode||(this.mode=this.graph.mode);"canvas"===c||this.svgShape||"jmGraph"===this.type||(this.svgShape=this.context.create("path",this));var d=this;this.children=function(){var a=new jmUtils.list,b=a.add;return a.add=function(a){return"object"==typeof a?(a.parent&&a.parent!=d&&a.parent.children&&a.parent.children.remove(a),a.parent=d,this.contain(a)&&this.oremove(a),b.call(this,a),a.emit("add",a),a):void 0},a.oremove=a.remove,a.remove=function(a){"object"==typeof a&&(a.parent=null,a.remove(!0),this.oremove(a))},a.sort=function(){var c={};a.each(function(a,b){var d=b.zIndex;if(!d&&b.style&&b.style.zIndex&&(d=Number(b.style.zIndex)),d){var e=c[d]||(c[d]=[]);e.push(b)}});for(var d in c)b.call(this,c[d])},a.clear=function(){a.each(function(a,b){this.remove(b)},!0)},a}()},jmControl.prototype.cursor=function(a){if(this.svgShape)this.svgShape.css("cursor",a);else{var b=this.graph||this.findParent("jmGraph");b&&b.css("cursor",a)}},jmControl.prototype.setStyle=function(a){function b(a,c,d,e){var f=c[d];if(f)if(a.mode&&"canvas"!=a.mode)a.svgShape&&a.svgShape.attr(e||d,f);else{var g="jm_control_style_mapping",h=jmUtils.cache.get(g);h||(h={fill:"fillStyle",stroke:"strokeStyle","shadow.blur":"shadowBlur","shadow.x":"shadowOffsetX","shadow.y":"shadowOffsetY","shadow.color":"shadowColor",lineWidth:"lineWidth",fillStyle:"fillStyle",strokeStyle:"strokeStyle",font:"font",opacity:"globalAlpha",textAlign:"textAlign",textBaseline:"textBaseline",shadowBlur:"shadowBlur",shadowOffsetX:"shadowOffsetX",shadowOffsetY:"shadowOffsetY",shadowColor:"shadowColor",lineJoin:"lineJoin",lineCap:"lineCap"},jmUtils.cache.add(g,h));var i=typeof f;if("object"!=i||h[d]){if("object"==i&&jmUtils.isType(f,jmGradient)){var j=h[e||d]||d;a.context[j]=f.toGradient(a)}else if("function"!=i&&"object"!=i){var j=h[e||d];if(j)a.context[j]=f;else switch(d){case"rotate":var k=0,l=0;if(a.rotatePosition){var m=a.parent&&a.parent.absoluteBounds?a.parent.absoluteBounds:a.absoluteBounds;k=a.rotatePosition.x+m.left,l=a.rotatePosition.y+m.top}a.context.translate(k,l),a.context.rotate(f);break;case"transform":jmUtils.isArray(f)?a.context.transform.apply(a.context,f):"object"==typeof f&&a.context.transform(f.scaleX,f.skewX,f.skewY,f.scaleY,f.offsetX,f.offsetY);break;case"translate":a.context.translate(f.x,f.y);break;case"cursor":a.cursor(f)}}}else switch(d){case"shadow":for(var n in f)b(a,f,n,d+"."+n);break;case"translate":a.context.translate(f.x,f.y)}}}if(a=a||this.style){this.translate&&b(this,{translate:this.translate},"translate"),this.transform&&b(this,{transform:this.transform},"transform"),this.rotate&&b(this,{rotate:this.rotate},"rotate");for(var c in a)b(this,a,c)}},jmControl.prototype.getBounds=function(){var a={};if(this.points&&this.points.length>0)for(var b in this.points){var c=this.points[b];("undefined"==typeof a.left||a.left>c.x)&&(a.left=c.x),("undefined"==typeof a.top||a.top>c.y)&&(a.top=c.y),("undefined"==typeof a.right||a.right<c.x)&&(a.right=c.x),("undefined"==typeof a.bottom||a.bottom<c.y)&&(a.bottom=c.y)}else if(this.getLocation){var c=this.getLocation();c&&(a.left=c.left,a.top=c.top,a.right=c.left+c.width,a.bottom=c.top+c.height)}return a.left||(a.left=0),a.top||(a.top=0),a.right||(a.right=0),a.bottom||(a.bottom=0),a.width=a.right-a.left,a.height=a.bottom-a.top,a},jmControl.prototype.getLocation=function(a){if(a!==!0&&this.location)return this.location;var b=this.location={left:0,top:0,width:0,height:0},c=this.position();b.center=this.center&&"function"==typeof this.center?jmUtils.clone(this.center()):null,b.radius=this.radius?this.radius():null,b.width=this.width()||0,b.height=this.height()||0;var d=this.style.margin||{};if(d.left=d.left||0,d.top=d.top||0,d.right=d.right||0,d.bottom=d.bottom||0,c?(b.left=c.x,b.top=c.y):(b.left=d.left,b.top=d.top),!this.parent)return b;var e=this.parent.bounds?this.parent.bounds:this.parent.getBounds();return jmUtils.checkPercent(b.left)&&(b.left=jmUtils.percentToNumber(b.left)*e.width),jmUtils.checkPercent(b.top)&&(b.top=jmUtils.percentToNumber(b.top)*e.height),jmUtils.checkPercent(b.width)&&(b.width=jmUtils.percentToNumber(b.width)*e.width),jmUtils.checkPercent(b.height)&&(b.height=jmUtils.percentToNumber(b.height)*e.height),b.center&&(jmUtils.checkPercent(b.center.x)&&(b.center.x=jmUtils.percentToNumber(b.center.x)*e.width),jmUtils.checkPercent(b.center.y)&&(b.center.y=jmUtils.percentToNumber(b.center.y)*e.height)),b.radius&&jmUtils.checkPercent(b.radius)&&(b.radius=jmUtils.percentToNumber(b.radius)*Math.min(e.width,e.height)),b},jmControl.prototype.remove=function(){this.svgShape&&this.svgShape.remove(),this.parent&&this.parent.children.remove(this)},jmControl.prototype.position=function(a){return this.setValue("position",a)},jmControl.prototype.width=function(a){return this.setValue("width",a)},jmControl.prototype.height=function(a){
return this.setValue("height",a)},jmControl.prototype.offset=function(a,b,c){c=c===!1?!1:!0;var d=this.getLocation(!0),e=!1;if(this.center&&"function"==typeof this.center){var f=this.center();f&&(f.x=d.center.x+a,f.y=d.center.y+b,e=!0)}if(0==e&&this.position&&"function"==typeof this.position){var g=this.position();g&&(d.left+=a,d.top+=b,g.x=d.left,g.y=d.top,e=!0)}if(0==e&&this.cpoints&&"function"==typeof this.cpoints){var g=this.cpoints();if(g){for(var h=g.length,i=0;h>i;i++)g[i].x+=a,g[i].y+=b;e=!0}}if(0==e&&this.points){for(var h=this.points.length,i=0;h>i;i++)this.points[i].x+=a,this.points[i].y+=b;e=!0}this.emit("move",{offsetX:a,offsetY:b,trans:c}),this.graph.refresh()},jmControl.prototype.getAbsoluteBounds=function(){var a=this.bounds||this.getBounds();if(this.parent&&this.parent.absoluteBounds){var b=this.parent.absoluteBounds||this.parent.getAbsoluteBounds();return{left:b.left+a.left,top:b.top+a.top,right:b.left+a.right,bottom:b.top+a.bottom,width:a.width,height:a.height}}return a},jmControl.prototype.beginDraw=function(){this.getLocation(!0),this.context.beginPath()},jmControl.prototype.endDraw=function(){this.style.close&&this.context.closePath(),this.style.fill&&this.context.fill(),(this.style.stroke||!this.style.fill)&&this.context.stroke()},jmControl.prototype.draw=function(){if(this.points&&this.points.length>0){var a=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;if(this.mode&&"canvas"!=this.mode){this.svgShape.setStyle(this);for(var b=this.points.slice(0),c=b.length,d=0;c>d;d++)b[d].x+=a.left,b[d].y+=a.top;this.svgShape.attr("path",b,this.style.close)}else{this.context.moveTo(this.points[0].x+a.left,this.points[0].y+a.top);for(var c=this.points.length,d=1;c>d;d++){var e=this.points[d];e.m?this.context.moveTo(e.x+a.left,e.y+a.top):this.context.lineTo(e.x+a.left,e.y+a.top)}}}},jmControl.prototype.paint=function(a){a!==!1&&this.visible!==!1?(this.svgShape&&this.svgShape.show(),this.initPoints&&this.initPoints(),this.bounds=this.getBounds(),this.absoluteBounds=this.getAbsoluteBounds(),this.context.save(),this.svgShape&&this.svgShape.glow&&this.svgShape.glow.remove(),this.setStyle(),this.emit("beginDraw",this),this.beginDraw&&this.beginDraw(),this.draw&&this.draw(),this.endDraw&&this.endDraw(),this.children&&(this.children.sort(),this.children.each(function(a,b){b&&b.paint&&b.paint()})),this.emit("endDraw",this),this.context.restore()):this.svgShape&&(this.svgShape.hide(),this.children&&this.children.each(function(a,b){b&&b.paint&&b.paint(!1)}))},jmControl.prototype.getEvent=function(a){return this.__events?this.__events[a]:null},jmControl.prototype.bind=function(a,b){function c(a,b){return this.__events||(this.__events={}),this.__events[a]=b}var d=this.getEvent(a)||c.call(this,a,new jmUtils.list);d.contain(b)||d.add(b)},jmControl.prototype.unbind=function(a,b){var c=this.getEvent(a);c&&c.remove(b)},jmControl.prototype.checkPoint=function(a){var b=this.bounds||this.getBounds();return a.x>b.right||a.x<b.left?!1:a.y>b.bottom||a.y<b.top?!1:!0},jmControl.prototype.raiseEvent=function(a,b){if(this.visible!==!1){if(!b.position){var c=this.findParent("jmGraph"),d=jmUtils.getEventPosition(b,c.scaleSize);if("canvas"!==this.mode){var e=c.getPosition();d.x=d.offsetX=d.pageX-e.left,d.y=d.offsetY=d.pageY-e.top}var f=b.srcElement||b.target;b={position:d,button:0==b.button?1:b.button,keyCode:b.keyCode||b.charCode||b.which,ctrlKey:b.ctrlKey,cancel:!1,srcElement:f}}this.children&&this.children.each(function(c,d){b.cancel!==!0&&d.raiseEvent(a,b)},!0);var g=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;return g?(b.position.x=b.position.offsetX-g.left,b.position.y=b.position.offsetY-g.top,this.checkPoint(b.position)?(b.target||(b.target=this),b.cancel!==!0&&runEventHandle.call(this,a,b),this.focused||"mousemove"!=a||(this.focused=!0,this.raiseEvent("mouseover",b))):this.focused&&"mousemove"==a&&(this.focused=!1,runEventHandle.call(this,"mouseleave",b)),0==b.cancel):!1}},jmControl.prototype.clearEvents=function(a){var b=this.getEvent(a);b&&b.clear},jmControl.prototype.findParent=function(a){if("string"==typeof a){if(this.type==a)return this}else if(this.is(a))return this;return this.parent?this.parent.findParent(a):null},jmControl.prototype.canMove=function(a,b){if(!this.__mvMonitor){this.__mvMonitor={},this.__mvMonitor.mouseDown=!1,this.__mvMonitor.curposition={x:0,y:0};var c=this;this.__mvMonitor.mv=function(a){var b=c;if(b.__mvMonitor.mouseDown){b.parent.bounds=null;var d=b.parent.getAbsoluteBounds(),e=a.position.x-b.__mvMonitor.curposition.x,f=a.position.y-b.__mvMonitor.curposition.y;if(b.lockSide){var g=b.bounds||b.getAbsoluteBounds(),h=jmUtils.checkOutSide(d,g,{x:e,y:f});h.left<0?b.lockSide.left&&(e-=h.left):h.right>0&&b.lockSide.right&&(e-=h.right),h.top<0?b.lockSide.top&&(f-=h.top):h.bottom>0&&b.lockSide.bottom&&(f-=h.bottom)}return(e||f)&&(b.offset(e,f),b.__mvMonitor.curposition.x=a.position.x,b.__mvMonitor.curposition.y=a.position.y),!1}},this.__mvMonitor.mu=function(a){var b=c;b.__mvMonitor.mouseDown&&(b.__mvMonitor.mouseDown=!1,b.cursor("default"),b.emit("moveend",{position:b.__mvMonitor.curposition}))},this.__mvMonitor.ml=function(){var a=c;return a.__mvMonitor.mouseDown?(a.__mvMonitor.mouseDown=!1,a.cursor("default"),a.emit("moveend",{position:a.__mvMonitor.curposition}),!1):void 0},this.__mvMonitor.md=function(a){var b=c;if(!b.__mvMonitor.mouseDown&&(0==a.button||1==a.button)){b.__mvMonitor.mouseDown=!0,b.cursor("move");var d=b.parent.absoluteBounds||b.parent.getAbsoluteBounds();return b.__mvMonitor.curposition.x=a.position.x+d.left,b.__mvMonitor.curposition.y=a.position.y+d.top,b.emit("movestart",{position:b.__mvMonitor.curposition}),a.cancel=!0,!1}}}b=b||this.graph||this.findParent("jmGraph"),b&&a?(b.bind("mousemove",this.__mvMonitor.mv),b.bind("mouseup",this.__mvMonitor.mu),b.bind("mouseleave",this.__mvMonitor.ml),this.bind("mousedown",this.__mvMonitor.md),b.bind("touchmove",this.__mvMonitor.mv),b.bind("touchend",this.__mvMonitor.mu),this.bind("touchstart",this.__mvMonitor.md)):(b.unbind("mousemove",this.__mvMonitor.mv),b.unbind("mouseup",this.__mvMonitor.mu),b.unbind("mouseleave",this.__mvMonitor.ml),this.unbind("mousedown",this.__mvMonitor.md),b.unbind("touchmove",this.__mvMonitor.mv),b.unbind("touchend",this.__mvMonitor.mu),this.unbind("touchstart",this.__mvMonitor.md))},jmUtils.extend(jmShape,jmControl),jmUtils.extend(jmPath,jmShape),jmPath.prototype.checkPoint=function(a){var b=this.style.lineWidth||1;if(this.points.length>2&&(!this.style.fill||this.style.stroke)){for(var c=0,d=this.points.length,e=c+1;d>=e;e=++c+1)if(e==d){if(this.style.close){var f=jmUtils.pointInPolygon(a,[this.points[c],this.points[0]],b);if(f)return!0}}else{var g=jmUtils.pointInPolygon(a,[this.points[c],this.points[e]],b);if(g)return!0}if(!this.style.fill)return!1}var f=jmUtils.pointInPolygon(a,this.points,b);return f},jmUtils.extend(jmLine,jmPath),jmLine.prototype.initPoints=function(){var a=this.start(),b=this.end();if(this.points=[],this.points.push(a),"dotted"===this.style.lineType){var c=b.x-a.x,d=b.y-a.y,e=Math.sqrt(c*c+d*d);c/=e,d/=e;for(var f=!1,g=this.style.dashLength/2,h=this.style.dashLength;e>=h;)0==f?(this.points.push({x:a.x+c*h,y:a.y+d*h}),h+=g):(this.points.push({x:a.x+c*h,y:a.y+d*h,m:!0}),h+=this.style.dashLength),f=!f}return this.points.push(b),this.points},jmLine.prototype.start=function(a){return this.setValue("start",a)},jmLine.prototype.end=function(a){return this.setValue("end",a)},jmUtils.extend(jmCircle,jmPath),jmCircle.prototype.initPoints=function(){var a=this.getLocation();a.radius||(a.radius=Math.min(a.width,a.height)/2),this.points=[],this.points.push({x:a.center.x-a.radius,y:a.center.y-a.radius}),this.points.push({x:a.center.x+a.radius,y:a.center.y-a.radius}),this.points.push({x:a.center.x+a.radius,y:a.center.y+a.radius}),this.points.push({x:a.center.x-a.radius,y:a.center.y+a.radius})},jmCircle.prototype.draw=function(){var a=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds,b=this.getLocation();b.radius||(b.radius=Math.min(b.width,b.height)/2),this.mode&&"canvas"!=this.mode?(this.svgShape||(this.svgShape=this.context.create("circle",this),this.setStyle(),this.svgShape.appendTo(this.graph.canvas)),this.svgShape.setStyle(this),this.svgShape.attr({cx:b.center.x+a.left,cy:b.center.y+a.top,r:b.radius})):this.context.arc(b.center.x+a.left,b.center.y+a.top,b.radius,0,2*Math.PI)},jmCircle.prototype.center=function(a){return this.setValue("center",a)},jmCircle.prototype.radius=function(a){return this.setValue("radius",a)},jmUtils.extend(jmArc,jmPath),jmArc.prototype.initPoints=function(){var a=this.getLocation(),b=0,c=0,d=a.center.x,e=a.center.y;a.radius?b=c=a.radius:(b=a.width/2,c=a.height/2);var f=this.startAngle(),g=this.endAngle(),h=this.anticlockwise();if(this.points=[],g>f)for(var i=f;g>=i;i+=.01){var j=h?-i:i,k={x:Math.cos(j)*b+d,y:Math.sin(j)*c+e};this.points.push(k)}else for(var i=f;i>=g;i-=.01){var j=h?-i:i,k={x:Math.cos(j)*b+d,y:Math.sin(j)*c+e};this.points.push(k)}return this.points},jmArc.prototype.center=function(a){return this.setValue("center",a)},jmArc.prototype.radius=function(a){return this.setValue("radius",a)},jmArc.prototype.startAngle=function(a){return this.setValue("startAngle",a)},jmArc.prototype.endAngle=function(a){return this.setValue("endAngle",a)},jmArc.prototype.anticlockwise=function(a){return this.setValue("anticlockwise",a)},jmUtils.extend(jmHArc,jmPath),jmHArc.prototype.initPoints=function(){for(var a=this.getLocation(),b=this.minRadius(),c=this.maxRadius(),d=this.startAngle(),e=this.endAngle(),f=this.anticlockwise(),g=[],h=[],i=d;e>=i;i+=.1){var j=f?-i:i,k=Math.cos(j),l=Math.sin(j),m={x:k*b+a.center.x,y:l*b+a.center.y},n={x:k*c+a.center.x,y:l*c+a.center.y};g.push(m),h.push(n)}h.reverse(),this.style&&this.style.close||(h[0].m=!0),this.points=g.concat(h)},jmHArc.prototype.center=function(a){return this.setValue("center",a)},jmHArc.prototype.minRadius=function(a){return this.setValue("minRadius",a)},jmHArc.prototype.maxRadius=function(a){return this.setValue("maxRadius",a)},jmHArc.prototype.startAngle=function(a){return this.setValue("startAngle",a)},jmHArc.prototype.endAngle=function(a){return this.setValue("endAngle",a)},jmHArc.prototype.anticlockwise=function(a){return this.setValue("anticlockwise",a)},jmUtils.extend(jmPrismatic,jmPath),jmPrismatic.prototype.initPoints=function(){var a=this.getLocation(),b=a.width/2,c=a.height/2;this.points=[],this.points.push({x:a.center.x-b,y:a.center.y}),this.points.push({x:a.center.x,y:a.center.y+c}),this.points.push({x:a.center.x+b,y:a.center.y}),this.points.push({x:a.center.x,y:a.center.y-c})},jmPrismatic.prototype.center=function(a){return this.setValue("center",a)},jmUtils.extend(jmFusiformis,jmPath),jmFusiformis.prototype.initPoints=function(){var a=this.getLocation(),b=a.width/2,c=a.height/2;2*c>b&&(this.width=4*c,b=2*c),this.points=[],this.points.push({x:a.center.x-b,y:a.center.y}),this.points.push({x:a.center.x-b+c,y:a.center.y-c}),this.points.push({x:a.center.x+b-c,y:a.center.y-c}),this.points.push({x:a.center.x+b,y:a.center.y}),this.points.push({x:a.center.x+b-c,y:a.center.y+c}),this.points.push({x:a.center.x-b+c,y:a.center.y+c})},jmFusiformis.prototype.center=function(a){return this.setValue("center",a)},jmUtils.extend(jmBezier,jmPath),jmBezier.prototype.initPoints=function(){this.points=[];for(var a=this.cpoints(),b=0;1>=b;b+=.01){var c=this.getPoint(a,b);this.points.push(c)}return this.points.push(a[a.length-1]),this.points},jmBezier.prototype.getPoint=function(a,b){if(1==a.length)return a[0];if(2==a.length){var c={};return c.x=(a[1].x-a[0].x)*b+a[0].x,c.y=(a[1].y-a[0].y)*b+a[0].y,c}if(a.length>2){for(var d=[],e=0;e<a.length-1;e++){var c=this.getPoint([a[e],a[e+1]],b);c&&d.push(c)}return this.getPoint(d,b)}},jmBezier.prototype.offset=function(a,b,c){var d=this.cpoints();if(d){for(var e=d.length,f=0;e>f;f++)d[f].x+=a,d[f].y+=b;this.emit("move",{offsetX:a,offsetY:b,trans:c}),this.getLocation(!0),this.graph.refresh()}},jmBezier.prototype.cpoints=function(a){return this.setValue("cpoints",a)},jmUtils.extend(jmRect,jmPath),jmRect.prototype.getBounds=function(){var a={};this.initPoints();var b=this.getLocation();return a.left=b.left,a.top=b.top,a.right=b.x+b.width,a.bottom=b.y+b.height,a.width=a.right-a.left,a.height=a.bottom-a.top,a},jmRect.prototype.checkPoint=function(a){var b=this.bounds||this.getBounds();return a.x>b.right||a.x<b.left?!1:a.y>b.bottom||a.y<b.top?!1:!0},jmRect.prototype.initPoints=function(){var a=this.getLocation(),b={x:a.left,y:a.top},c={x:a.left+a.width,y:a.top},d={x:a.left+a.width,y:a.top+a.height},e={x:a.left,y:a.top+a.height};if(a.radius&&a.radius<a.width/2&&a.radius<a.height/2){var f=Math.PI/2,g=this.graph.createShape("arc",{radius:a.radius,anticlockwise:!1});g.center({x:a.left+a.radius,y:a.top+a.radius}),g.startAngle(Math.PI),g.endAngle(Math.PI+f);var h=g.initPoints();g=this.graph.createShape("arc",{radius:a.radius,anticlockwise:!1}),g.center({x:c.x-a.radius,y:c.y+a.radius}),g.startAngle(Math.PI+f),g.endAngle(2*Math.PI);var i=g.initPoints();g=this.graph.createShape("arc",{radius:a.radius,anticlockwise:!1}),g.center({x:d.x-a.radius,y:d.y-a.radius}),g.startAngle(0),g.endAngle(f);var j=g.initPoints();g=this.graph.createShape("arc",{radius:a.radius,anticlockwise:!1}),g.center({x:e.x+a.radius,y:e.y-a.radius}),g.startAngle(f),g.endAngle(Math.PI);var k=g.initPoints();this.points=h.concat(i,j,k)}else this.points=[],this.points.push(b),this.points.push(c),this.points.push(d),this.points.push(e);return this.points},jmRect.prototype.radius=function(a){return this.setValue("radius",a)},jmUtils.extend(jmSequence,jmPath),jmSequence.prototype.getBounds=function(){var a={};this.initPoints();var b=this.getLocation();return a.left=b.left,a.top=b.top,a.right=b.x+b.width,a.bottom=b.y+b.height,a.width=a.right-a.left,a.height=a.bottom-a.top,a},jmSequence.prototype.checkPoint=function(a){var b=this.bounds||this.getBounds();return a.x>b.right||a.x<b.left?!1:a.y>b.bottom||a.y<b.top?!1:!0},jmSequence.prototype.initPoints=function(){var a=this.getLocation(),b={x:a.left,y:a.top},c={x:a.left+a.width,y:a.top},d={x:a.left+a.width,y:a.top+a.height},e={x:a.left,y:a.top+a.height};if(a.radius&&a.radius<a.width/2&&a.radius<a.height/2){var f=Math.PI/2,g=this.graph.createShape("arc",{radius:a.radius,anticlockwise:!1});g.center({x:a.left+a.radius,y:a.top+a.radius}),g.startAngle(Math.PI),g.endAngle(Math.PI+f);var h=g.initPoints();g=this.graph.createShape("arc",{radius:a.radius,anticlockwise:!1}),g.center({x:c.x-a.radius,y:c.y+a.radius}),g.startAngle(Math.PI+f),g.endAngle(2*Math.PI);var i=g.initPoints();g=this.graph.createShape("arc",{radius:a.radius,anticlockwise:!1}),g.center({x:d.x-a.radius,y:d.y-a.radius}),g.startAngle(0),g.endAngle(f);var j=g.initPoints();g=this.graph.createShape("arc",{radius:a.radius,anticlockwise:!1}),g.center({x:e.x+a.radius,y:e.y-a.radius}),g.startAngle(f),g.endAngle(Math.PI);var k=g.initPoints();this.points=h.concat(i,j,k)}else this.points=[],this.points.push(b),this.points.push(c),this.points.push(d),this.points.push(e);return this.points},jmSequence.prototype.radius=function(a){return this.setValue("radius",a)},jmUtils.extend(jmArraw,jmPath),jmArraw.prototype.initPoints=function(a){var b=this.angle(),c=this.start(),d=this.end();if(d){b||(b=Math.atan2(d.y-c.y,d.x-c.x)),this.points=[];var e=this.offsetX(),f=this.offsetY(),g=Math.atan2(e,f),h=b+g,i=Math.sin(h),j=Math.cos(h),k=Math.sqrt(e*e+f*f),l=i*k,m=j*k,n={x:d.x-m,y:d.y-l},o=b-g;i=Math.sin(o),j=Math.cos(o),l=i*k,m=j*k;var p={x:d.x-m,y:d.y-l},q=jmUtils.clone(d);return q.m=!0,this.points.push(q),this.points.push(n),a||this.style.fill?(this.points.push(p),this.points.push(q)):(this.points.push(q),this.points.push(p)),this.points}},jmArraw.prototype.start=function(a){return this.setValue("start",a)},jmArraw.prototype.end=function(a){return this.setValue("end",a)},jmArraw.prototype.angle=function(a){return this.setValue("angle",a)},jmArraw.prototype.offsetX=function(a){return this.setValue("offsetX",a)},jmArraw.prototype.offsetY=function(a){return this.setValue("offsetY",a)},jmUtils.extend(jmLabel,jmControl),jmLabel.prototype.initPoints=function(){var a=this.getLocation();a.width,a.height;return this.points=[{x:a.left,y:a.top}],this.points.push({x:a.left+a.width,y:a.top}),this.points.push({x:a.left+a.width,y:a.top+a.height}),this.points.push({x:a.left,y:a.top+a.height}),this.points},jmLabel.prototype.testSize=function(){this.context.save(),this.setStyle();var a=this.context.measureText?this.context.measureText(this.value):{width:this.svgShape?this.svgShape.element.getBBox().width:15};return this.context.restore(),a.height=15,a},jmLabel.prototype.draw=function(){var a=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds,b=this.getLocation(),c=b.left+a.left,d=b.top+a.top;switch(this.style.textAlign){case"right":c+=b.width;break;case"center":c+=b.width/2}switch(this.style.textBaseline){case"bottom":d+=b.height;break;case"hanging":case"alphabetic":case"middle":d+=b.height/2}"canvas"==this.mode?(this.value&&(this.style.fill&&this.context.fillText?this.style.maxWidth?this.context.fillText(this.value,c,d,this.style.maxWidth):this.context.fillText(this.value,c,d):this.context.strokeText&&(this.style.maxWidth?this.context.strokeText(this.value,c,d,this.style.maxWidth):this.context.strokeText(this.value,c,d))),this.style.border&&(this.context.moveTo(this.points[0].x+a.left,this.points[0].y+a.top),this.style.border.top&&this.context.lineTo(this.points[1].x+a.left,this.points[1].y+a.top),this.style.border.right&&(this.context.moveTo(this.points[1].x+a.left,this.points[1].y+a.top),this.context.lineTo(this.points[2].x+a.left,this.points[2].y+a.top)),this.style.border.bottom&&(this.context.moveTo(this.points[2].x+a.left,this.points[2].y+a.top),this.context.lineTo(this.points[3].x+a.left,this.points[3].y+a.top)),this.style.border.left&&(this.context.moveTo(this.points[3].x+a.left,this.points[3].y+a.top),this.context.lineTo(this.points[0].x+a.left,this.points[0].y+a.top)))):this.svgShape.attr({x:c,y:d,text:this.value})},jmLabel.prototype.width=function(a){return a?this.setValue("width",a):(a=this.getValue("width"))?a:this.context?this.testSize().width:void 0},jmUtils.extend(jmImage,jmControl),jmImage.prototype.draw=function(){try{var a=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds;a||(a=this.parent&&this.parent.getAbsoluteBounds?this.parent.getAbsoluteBounds():this.getAbsoluteBounds());var b=this.getLocation();b.left+=a.left,b.top+=a.top;var c=this.sourcePosition(),d=this.sourceWidth(),e=this.sourceHeight(),f=this.image();(d||e)&&(d||(d=b.width),e||(e=b.height),c||(c={x:0,y:0})),c?b.width&&b.height?this.context.drawImage(f,c.x,c.y,d,e,b.left,b.top,b.width,b.height):b.width?this.context.drawImage(f,c.x,c.y,d,e,b.left,b.top,b.width,f.height):b.height?this.context.drawImage(f,c.x,c.y,d,e,b.left,b.top,f.width,b.height):this.context.drawImage(f,c.x,c.y,d,e,b.left,b.top):b?b.width&&b.height?this.context.drawImage(f,b.left,b.top,b.width,b.height):b.width?this.context.drawImage(f,b.left,b.top,b.width,f.height):b.height?this.context.drawImage(f,b.left,b.top,f.width,b.height):this.context.drawImage(f,b.left,b.top):this.context.drawImage(this.image())}catch(g){console.log(g)}},jmImage.prototype.getBounds=function(){var a={},b=this.image(),c=this.getLocation(),d=c.width||b.width,e=c.height||b.height;return a.left=c.left,a.top=c.top,a.right=c.left+d,a.bottom=c.top+e,a.width=d,a.height=e,a},jmImage.prototype.image=function(a){if(a&&"string"==typeof a){var b=document.createElement("img");b.src=a,a=b}return this.setValue("image",a)},jmImage.prototype.position=function(a){return this.setValue("position",a)},jmImage.prototype.sourcePosition=function(a){return this.setValue("sourcePosition",a)},jmImage.prototype.sourceWidth=function(a){return this.setValue("sourceWidth",a)},jmImage.prototype.sourceHeight=function(a){return this.setValue("sourceHeight",a)},jmUtils.extend(jmResize,jmRect),jmResize.prototype.init=function(){if(this.params.resizable!==!1){this.resizeRects=[];for(var a=this.rectSize(),b=0;8>b;b++){var c=this.graph.createShape("rect",{position:{x:0,y:0},width:a,height:a,style:{stroke:this.style.rectStroke||"red",close:!0,zIndex:100}});c.index=b,c.visible=!0,this.resizeRects.push(c),this.children.add(c),c.canMove(!0,this.graph)}this.reset(0,0,0,0),this.bindRectEvents()}},jmResize.prototype.bindRectEvents=function(){var a=this;for(var b in this.resizeRects){var c=this.resizeRects[b];c.on("move",function(b){var c=0,d=0,e=0,f=0;0==this.index?(e=-b.offsetX,c=b.offsetX):1==this.index?(e=-b.offsetX,c=b.offsetX,f=-b.offsetY,d=b.offsetY):2==this.index?(f=-b.offsetY,d=b.offsetY):3==this.index?(e=b.offsetX,f=-b.offsetY,d=b.offsetY):4==this.index?e=b.offsetX:5==this.index?(e=b.offsetX,f=b.offsetY):6==this.index?f=b.offsetY:7==this.index&&(e=-b.offsetX,c=b.offsetX,f=b.offsetY),a.reset(c,d,e,f)}),c.bind("mousemove",function(){var a=["w-resize","nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize"];this.cursor(a[this.index])}),c.bind("mouseleave",function(){this.cursor("default")})}},jmResize.prototype.reset=function(a,b,c,d){var e=5,f=this.getLocation();if(0!=c||0!=d){var g=f.width+c,h=f.height+d;if(g>=e&&h>=e){if(this.width(g),this.height(h),this.params.movable!==!1){var i=this.position();i.x=f.left+a,i.y=f.top+b,this.position(i)}this.emit("resize",a,b,c,d)}}for(var j in this.resizeRects){var k=this.resizeRects[j];switch(k.index){case 0:k.position().x=-k.width()/2,k.position().y=(f.height-k.height())/2;break;case 1:k.position().x=-k.width()/2,k.position().y=-k.height()/2;break;case 2:k.position().x=(f.width-k.width())/2,k.position().y=-k.height()/2;break;case 3:k.position().x=f.width-k.width()/2,k.position().y=-k.height()/2;break;case 4:k.position().x=f.width-k.width()/2,k.position().y=(f.height-k.height())/2;break;case 5:k.position().x=f.width-k.width()/2,k.position().y=f.height-k.height()/2;break;case 6:k.position().x=(f.width-k.height())/2,k.position().y=f.height-k.height()/2;break;case 7:k.position().x=-k.width()/2,k.position().y=f.height-k.height()/2}}},jmResize.prototype.rectSize=function(a){return this.setValue("rectSize",a)},jmResize.prototype.target=function(a){return this.setValue("target",a)},jmUtils.extend(jmArrawLine,jmPath),jmArrawLine.prototype.initPoints=function(){return this.points=this.line.initPoints(),this.arrawVisible!==!1&&(this.points=this.points.concat(this.arraw.initPoints())),this.points},jmUtils.extend(jmTooltip,jmControl),jmTooltip.prototype.setStyle=function(a){if(a=a||this.style,a&&"object"==typeof a)for(var b in a)if("string"==typeof b&&"string"==typeof a[b])try{this.element.style[b]=a[b]}catch(c){window.console.log(c)}},jmTooltip.prototype.draw=function(){this.setPosition()},jmTooltip.prototype.setPosition=function(a,b){this.x=a||this.x||0,this.y=b||this.y||0;var c=this.parent&&this.parent.absoluteBounds?this.parent.absoluteBounds:this.absoluteBounds,d=this.getLocation();a=this.x+d.left+c.left,b=this.y+d.top+c.top;var e=this.graph.getPosition();a+=e.left,b+=e.top,this.element.style.top=b+"px",this.element.style.left=a+"px"},jmTooltip.prototype.remove=function(){this.element&&document.body.removeChild(this.element)},jmTooltip.prototype.show=function(){this.element&&(this.element.style.display="inline")},jmTooltip.prototype.hide=function(){this.element&&(this.element.style.display="none")},jmTooltip.prototype.value=function(a){return this.element?(void 0!==a&&(this.element.innerHTML=a),this.element.innerHTML):void 0},jmTooltip.prototype.width=function(a){return this.element?(void 0!==a&&(this.element.style.width=a+"px"),this.element.clientWidth):void 0},jmTooltip.prototype.height=function(a){return this.element?(void 0!==a&&(this.element.style.height=a+"px"),this.element.clientHeight):void 0},jmUtils.extend(jmGraph,jmControl),jmGraph.prototype.registerShape=function(a,b){a="jmGraph.shapes."+a,jmUtils.cache.get(a)||jmUtils.cache.set(a,b)},jmGraph.prototype.createShape=function(a,b){a="jmGraph.shapes."+a;var c=jmUtils.cache.get(a);if(c){b||(b={}),b.mode=this.mode;var d=new c(this,b);return d}},jmGraph.prototype.isSupportedBrowser=function(){var a=jmUtils.browser();return!a.msie||a.ver>8},jmGraph.prototype.createShadow=function(a,b,c,d){var e=new jmShadow(a,b,c,d);return e},jmGraph.prototype.createLinearGradient=function(a,b,c,d){var e=new jmGradient({type:"linear",x1:a,y1:b,x2:c,y2:d});return e},jmGraph.prototype.createRadialGradient=function(a,b,c,d,e,f){var g=new jmGradient({type:"radial",x1:a,y1:b,r1:c,x2:d,y2:e,r2:f});return g},jmGraph.prototype.refresh=function(){this.animate(function(){return!1},100,"jmgraph_refresh")},jmGraph.prototype.redraw=function(a,b){this.clear(a,b),this.paint()},jmGraph.prototype.clear=function(a,b){a&&b?(this.canvas.width=a,this.canvas.height=b,this.scaleSize&&this.context.scale&&this.context.scale(this.scaleSize.x,this.scaleSize.y)):(a=this.canvas.width,b=this.canvas.height,this.scaleSize&&(a/=this.scaleSize.x,b/=this.scaleSize.y)),this.context.clearRect&&this.context.clearRect(0,0,a,b)},jmGraph.prototype.css=function(a,b){this.canvas&&(this.canvas.style[a]=b)},jmGraph.prototype.createPath=function(a,b){var c=this.createShape("path",{points:a,style:b});return c},jmGraph.prototype.createLine=function(a,b,c){var d=this.createShape("line",{start:a,end:b,style:c});return d},jmGraph.prototype.getBounds=function(){var a={};return a.left=0,a.top=0,"function"==typeof this.canvas.width?a.right=this.canvas.width():a.right=this.canvas.width,"function"==typeof this.canvas.height?a.bottom=this.canvas.height():a.bottom=this.canvas.height,a.width=a.right,a.height=a.bottom,a},jmGraph.prototype.getPosition=function(){var a=jmUtils.getElementPosition(this.canvas.canvas||this.canvas);return a.width=this.canvas.width,a.height=this.canvas.height,a.right=a.left+a.width,a.bottom=a.top+a.height,a},jmGraph.prototype.checkPoint=function(a){var b=this.getPosition();return a.pageX>b.right||a.pageX<b.left?!1:a.pageY>b.bottom||a.pageY<b.top?!1:!0},jmGraph.prototype.zoomOut=function(){this.scale(.9,.9)},jmGraph.prototype.zoomIn=function(){this.scale(1.1,1.1)},jmGraph.prototype.zoomActual=function(){this.scaleSize?this.scale(1/this.scaleSize.x,1/this.scaleSize.y):this.scale(1,1)},jmGraph.prototype.width=function(a){return"undefined"!=typeof a&&(this.canvas.width=a),this.canvas.width},jmGraph.prototype.height=function(a){return"undefined"!=typeof a&&(this.canvas.height=a),this.canvas.height},jmGraph.prototype.scale=function(a,b){this.normalSize||(this.normalSize={width:this.canvas.width,height:this.canvas.height}),this.context.scale(a,b),this.scaleSize?this.scaleSize={x:a*this.scaleSize.x,y:b*this.scaleSize.y}:this.scaleSize={x:a,y:b},this.refresh()},jmGraph.prototype.toDataURL=function(){var a=this.canvas.toDataURL?this.canvas.toDataURL():"";return a},jmUtils.extend(jmCell,jmControl),jmCell.prototype.setStyle=function(a){if(a){var b=this.editor.styles[a];b?(this.styleName=a,this.style=jmUtils.clone(b)):(this.style=jmUtils.clone(a),b=a),"undefined"!=typeof this.style.resizable&&(this.resizable=this.style.resizable),this.style.zIndex=this.style.zIndex||1e3,this.fontStyle=b.fontStyle||this.editor.defaultStyle.font,this.style.padding=this.style.padding||{left:8,top:8,right:8,bottom:8},this.label&&(this.label.style=this.fontStyle),this.shape&&(b.zIndex=0,this.shape.style=b)}},jmCell.prototype.create=function(){this.connects=new jmUtils.list;var a=this.width(),b=this.height();this.center={x:a/2,y:b/2};var c;c=this.style.borderStyle?this.style.borderStyle:{stroke:this.style.borderStroke||this.editor.defaultStyle.cellBorder.stroke,rectStroke:this.style.borderStroke||this.editor.defaultStyle.cellBorder.stroke,close:!0},this.rect=this.graph.createShape("resize",{width:a,height:b,movable:!1,resizable:this.resizable,style:c}),this.rect.visible=!1;var d=this.option.shape||this.style.shape;if(d){var e=jmUtils.extend({style:this.style,width:"94%",height:"94%",center:this.center,position:{x:"3%",y:"3%"}},this.option);this.shape=this.graph.createShape(d,e)}if(this.connectable){var f=8,g=this.graph.createRadialGradient(f/2,f/2,0,f/2,f/2,f);g.addStop(0,"#00FF00"),g.addStop(1,"#059505"),this.connArc=this.graph.createShape("arc",{center:{x:"50%",y:"50%"},width:f,height:f,radius:f,style:{fill:g,close:!0,zIndex:200}}),this.connArc.visible=!1,this.connectLine=this.graph.createShape("arrawline",{start:this.center,end:this.connArc.center(),offsetX:6,offsetY:12,style:this.editor.defaultStyle.dragLine}),this.connectLine.visible=!1,this.children.add(this.connectLine)}this.label=this.graph.createShape("label",{style:this.fontStyle,width:"100%",height:"100%",value:this.value()}),this.setStyle(this.styleName)},jmCell.prototype.addPrecondition=function(a){var b=6*(this.preConditions.length+1),c=this.graph.createShape("line",{start:{x:2,y:b},end:{x:98,y:b},style:{stroke:"#6C54F3",normalStroke:"black",overStroke:"red",selectedStroke:"red",lineWidth:5,zIndex:100}});c.visible=!0,a=a||"preData_"+this.preConditions.length,c.value=a,this.children.add(c),this.preConditions.push(c)},jmCell.prototype.addPostcondition=function(a){console.log("add post condition");var b=this.height()-6*(this.postConditions.length+1),c=this.graph.createShape("line",{start:{x:2,y:b},end:{x:98,y:b},style:{stroke:"#33E",normalStroke:"black",overStroke:"red",selectedStroke:"red",lineWidth:5,zIndex:100}});c.visible=!0,a=a||"postData_"+this.postConditions.length,c.value=a,this.children.add(c),this.postConditions.push(c)},jmCell.prototype.add=function(){this.create(),this.children.add(this.rect),this.graph.children.add(this),this.editor.movable&&this.canMove(!0),this.shape&&this.children.add(this.shape),this.bind("mousedown",function(a){a.ctrlKey||this.selected||this.editor.selectAll(!1,this.id),this.selected||this.select(!0),a.cancel=!0}),this.bind("mouseup",function(a){var b=this.editor.connectFrom;b&&(b!=this&&b.connect(this)!==!1&&this.editor.save(),this.editor.connectFrom=null)}),this.bind("mouseover",function(a){}),this.bind("mousemove",function(a){}),this.bind("mouseleave",function(a){}),this.bind("mouseup",function(a){}),this.connectable&&(this.bind("mousemove",function(){this.connArc.visible=!0,this.graph.refresh()}),this.bind("mouseleave",function(){this.editor.connectFrom!=this&&(this.connArc.visible=!1,this.graph.refresh())}),this.children.add(this.connArc),this.connArc.canMove(!0),this.connArc.on("movestart",function(b){var c=a;c.editor.connectFrom=c,c.connectLine.visible=!0}),this.connArc.on("moveend",function(b){var c=a,d=c.connArc.center();d.x="50%",d.y="50%",c.editor.connectFrom=null,c.connectLine.visible=!1,c.connArc.visible=!1,c.graph.refresh()})),this.on("move",function(a){this.initPosition()}),this.children.add(this.label),this.resize();var a=this;this.rect.on("resize",function(b,c,d,e){var f=a;f.position().x+=b,f.position().y+=c;var g=f.width()+d,h=f.height()+e;f.width(g),f.height(h),f.resize()})},jmCell.prototype.setOverlay=function(a,b,c,d){if(!this.overlay){this.overlay=document.createElement("img"),this.overlay.style.position="absolute";var e=this.getAbsoluteBounds(),f=e.bottom,g=e.right;this.style&&this.style.overlay&&this.style.overlay.margin&&(this.style.overlay.margin.left&&(g+=this.style.overlay.margin.left),this.style.overlay.margin.top&&(f+=this.style.overlay.margin.top)),this.overlay.style.top=f+"px",this.overlay.style.left=g+"px",this.overlay.style.border="0",this.editor.container.appendChild(this.overlay)}return a?(this.overlay.src=a,this.overlay.width=b,this.overlay.height=c,this.overlay.title=d):this.overlay.visible=!1,this.overlay},jmCell.prototype.resize=function(){var a=this.width(),b=this.height(),c=this.center;this.style.padding?(a=a-(this.style.padding.left||0)-(this.style.padding.right||0),b=b-(this.style.padding.top||0)-(this.style.padding.bottom||0),c.x=a/2+(this.style.padding.left||0),c.y=b/2+(this.style.padding.top||0)):(c.x=a/2,c.y=b/2),this.connArc&&(this.connArc.center().x=c.x,
this.connArc.center().y=c.y),this.initPosition()},jmCell.prototype.initPosition=function(){var a=this.position();if(this.pos1||(this.pos1={}),this.pos1.x=a.x,this.pos1.y=a.y+this.height()/2,this.pos2||(this.pos2={}),this.pos2.x=a.x+this.width()/2,this.pos2.y=a.y,this.pos3||(this.pos3={}),this.pos3.x=a.x+this.width(),this.pos3.y=this.pos1.y,this.pos4||(this.pos4={}),this.pos4.x=this.pos2.x,this.pos4.y=a.y+this.height(),this.rect.width(this.width()),this.rect.height(this.height()),this.overlay)if("IMG"==this.overlay.tagName){var b=this.getAbsoluteBounds(),c=b.bottom,d=b.right;this.style&&this.style.overlay&&this.style.overlay.margin&&(this.style.overlay.margin.left&&(d+=this.style.overlay.margin.left),this.style.overlay.margin.top&&(c+=this.style.overlay.margin.top)),this.overlay.style.top=c+"px",this.overlay.style.left=d+"px"}else{var e=this.overlay.position();e.x=this.width(),e.y=this.height()}},jmCell.prototype.select=function(a,b){var c=!1;a===!1&&this.selected===!0?(this.rect.visible=!1,this.selected=!1,c=!0):a!==!0||this.selected||(this.selected=!0,this.rect.visible=!0,c=!0),c&&(this.graph.refresh(),b!==!1&&this.emit("select",this.selected))},jmCell.prototype.connect=function(a,b,c){var d=this.connects.get(function(b){return b.from==this&&b.to==a});if(!d){if(this.editor.validConnect&&!this.editor.validConnect(this,a))return!1;b=b||this.editor.maxId(),d=this.graph.createShape("cellConnectLine",{id:b,from:this,to:a,style:jmUtils.clone(this.style.connectLine),editor:this.editor}),this.connects.add(d),a.connects.add(d),d.value(c),this.graph.children.add(d),this.editor.connects.add(d),d.bind("mouseover",function(){if(!this.selected){var a=this.style&&this.style.overStroke?this.style.overStroke:jmEditorDefaultStyle.connectLine.overStroke;this.style.stroke=a,this.style.zIndex=2e3,this.graph.refresh()}}),d.bind("mouseleave",function(){if(!this.selected){var a=this.style&&this.style.normalStroke?this.style.normalStroke:jmEditorDefaultStyle.connectLine.stroke;this.style.stroke=a,this.style.zIndex=1,this.graph.refresh()}}),d.bind("mousedown",function(a){var b=this.selected;return a.ctrlKey||this.selected||this.editor.selectAll(!1,this.id),this.select(!b),!1})}},jmCell.prototype.value=function(a){return"undefined"!=typeof a?(this.label&&(this.label.value=a),this.setValue("value",a)):this.getValue("value")},jmCell.prototype.center=function(a){return this.setValue("center",a)},jmCell.prototype.remove=function(a){a||(this.editor&&(this.editor.cells.remove(this),this.graph.children.remove(this),this.overlay&&this.overlay.parentElement&&this.overlay.parentElement.removeChild(this.overlay)),this.connects.each(function(a,b){b.remove()},!0))},jmUtils.extend(jmConnectLine,jmBezier),jmConnectLine.prototype.initPoints=function(){var a=this.from.pos3,b=this.to.pos1;return this.points=this.getPoints(a,b),this.points},jmConnectLine.prototype.getPoints=function(a,b){var c=30,d=30,e=[a];if(a==this.from.pos1)switch(b){case this.to.pos1:var f=Math.min(a.x-c,b.x-c),g={x:f,y:a.y};e.push(g);var h={x:f,y:b.y};e.push(h);break;case this.to.pos2:var g={x:b.x,y:a.y};e.push(g);break;case this.to.pos3:var g={x:(a.x-b.x)/2+b.x,y:a.y};e.push(g);var h={x:g.x,y:b.y};e.push(h);break;case this.to.pos4:var g={x:b.x,y:a.y};e.push(g)}else if(a==this.from.pos2)switch(b){case this.to.pos1:var g={x:a.x,y:b.y};e.push(g);break;case this.to.pos2:var g={x:a.x,y:Math.min(a.y-d,b.y-d)};e.push(g);break;case this.to.pos3:var g={x:a.x,y:b.y};e.push(g);break;case this.to.pos4:var g={x:a.x,y:(a.y-b.y)/2+b.y};e.push(g);var h={x:b.x,y:g.y};e.push(h)}else if(a==this.from.pos3)switch(b){case this.to.pos1:var g={x:(b.x-a.x)/2+a.x,y:a.y};e.push(g);var h={x:g.x,y:b.y};e.push(h);break;case this.to.pos2:var g={x:b.x,y:a.y};e.push(g);break;case this.to.pos3:var g={x:Math.max(a.x+c,b.x+c),y:a.y};e.push(g);var h={x:g.x,y:b.y};e.push(h);break;case this.to.pos4:var g={x:b.x,y:a.y};e.push(g)}else if(a==this.from.pos4)switch(b){case this.to.pos1:var g={x:a.x,y:b.y};e.push(g);break;case this.to.pos2:var g={x:a.x,y:Math.max((b.y-a.y)/2+a.y,b.y-d)};e.push(g);var h={x:b.x,y:g.y};e.push(h);break;case this.to.pos3:var g={x:a.x,y:b.y};e.push(g);break;case this.to.pos4:var g={x:a.x,y:Math.max(a.y+c,b.y+c)};e.push(g);var h={x:b.x,y:g.y};e.push(h)}e.push(b);for(var i,j,k=jmUtils.clone(e[e.length-2]),l=jmUtils.clone(b),m=0;m<e.length;m++){var n=e[m];i=Math.min(i||n.x,n.x),j=Math.min(j||n.y,n.y)}k.x-=i,l.x-=i,k.y-=j,l.y-=j,this.arraw.start(k),this.arraw.end(l),this.arraw.style.stroke=this.arraw.style.fill=this.style.stroke;for(var o=[],p=0;1>=p;p+=.01){var n=this.getPoint(e,p);o.push(n)}return o.push(e[e.length-1]),o},jmConnectLine.prototype.select=function(a){if("undefined"!=typeof a){var b=!1;a&&0==this.selected?(this.style.stroke=this.style&&this.style.selectedStroke?this.style.selectedStroke:this.editor.defaultStyle.connectLine.overStroke,this.style.zIndex=10,this.selected=!0,b=!0):1==this.selected&&(this.style.stroke=this.style&&this.style.normalStroke?this.style.normalStroke:this.editor.defaultStyle.connectLine.stroke,this.style.zIndex=1,this.selected=!1,b=!0),b&&(this.editor.emit("select",this,a),this.graph.refresh())}},jmConnectLine.prototype.value=function(a){return"undefined"!=typeof a&&(this.label.value=a),this.label.value},jmConnectLine.prototype.remove=function(a){a||(this.from&&this.from.connects.remove(this),this.to&&this.to.connects.remove(this),this.editor&&this.editor.connects.remove(this),this.graph.children.remove(this))},jmUtils.extend(jmEditor,jmProperty),jmEditor.prototype.defaultStyle={dragLine:{stroke:"rgb(59,111,41)",lineWidth:1,lineType:"dotted",dashLength:6,zIndex:1e4},cellBorder:{stroke:"rgb(0,255,0)"},connectLine:{stroke:"rgb(59,255,41)",overStroke:"red",lineWidth:2},font:{textAlign:"center",textBaseline:"middle",fill:"blue",font:"20px Arial",border:null},selectRect:{stroke:"rgb(0,255,0)",lineWidth:1,zIndex:1e4}},jmEditor.prototype.menus=function(){if(!this.menuBody){var a=this.menuBody={};this.menuBody.panel=document.createElement("div"),this.menuBody.panel.style.display="none",this.menuBody.panel.className="editor-menu",this.menuBody.container=document.createElement("ul"),this.menuBody.panel.appendChild(this.menuBody.container),document.body.appendChild(this.menuBody.panel),this.menuBody.show=function(a,b){if(this.panel.style.display="inline",this.panel.style.position="absolute",a&&b)this.panel.style.top=b+1+"px",this.panel.style.left=a+1+"px";else{var c=jmUtils.getEventPosition(event);this.panel.style.top=c.pageY+1+"px",this.panel.style.left=c.pageX+1+"px"}return this},this.menuBody.add=function(b,c){var d=document.createElement("li");return"string"==typeof b?d.innerHTML=b:d.appendChild(b),d.onmouseup=function(){c&&c.call(this),a.hide()},this.container.appendChild(d),this},this.menuBody.hide=function(){return this.panel.style.display="none",this},this.graph.bind("mousedown",function(b){a.hide()})}return this.menuBody.container.innerHTML="",this.menuBody},jmEditor.prototype.addCell=function(a){if("precondition"==a.value||"effector"==a.value)return void console.log(a.value+" jmEditor");a=a||{},a.graph=this.graph,a.editor=this,this.isEnabled()&&this.option.resizable!==!1||(a.resizable=!1);var b=new jmCell(a);if(!this.validCell||this.validCell(b)){var c=this;return b.on("select",function(a){c.emit("select",this,a)}),b.on("move",function(a){var b=c;if(a.trans===!0)for(var d=b.getSelectedCells(),e=0;e<d.length;e++)d[e]!=this&&d[e].offset(a.offsetX,a.offsetY,!1);b.resize(this)}),b.id=a.id||this.maxId(),this.cells.add(b),b.add(),this.resize(b),b}},jmEditor.prototype.maxId=function(){var a=0;return this.cells.each(function(b,c){a=Math.max(c.id,a)}),this.connects.each(function(b,c){a=Math.max(c.id,a)}),a+1},jmEditor.prototype.isEnabled=function(a){return"undefined"!=typeof a&&(this.__enabled=a),this.__enabled},jmEditor.prototype.initEvents=function(){var a=this;this.graph.bind("mousedown",function(b){var c=a;return 0==b.button||1==b.button?(c.selectAll(!1),c.selecting=!0,c.selectRect.position({x:b.position.offsetX,y:b.position.offsetY}),c.selectRect.width(1),c.selectRect.height(1),c.selectRect.visible=!0,!1):void 0}),this.graph.bind("mouseup",function(b){if(a.currentComponent&&b.target){var c=b.target;if(c.findParent&&"jmCell"!=c.type&&(c=c.findParent("jmCell")),c){var d=a.currentComponent.img.getAttribute("alt");console.log(d+" on "+c.type+"do action: moveup"),"precondition"==d?c.addPrecondition():"effector"==d&&c.addPostcondition()}}}),this.graph.bind("mousemove",function(a){}),this.graph.bind("mousemove",function(b){var c=a;if(c.selecting){var d=c.selectRect.position(),e=b.position.offsetX-d.x,f=b.position.offsetY-d.y;return c.selectRect.width(e),c.selectRect.height(f),c.graph.refresh(),!1}}),jmUtils.bindEvent(document,"mouseleave",function(a){}),jmUtils.bindEvent(document,"mousemove",function(b){var c=a;if(c.currentComponent){b=b||event;var d=jmUtils.getEventPosition(b||event);return c.currentComponent.img.style.left=d.pageX+1+"px",c.currentComponent.img.style.top=d.pageY+"px",c.currentComponent.evtX=d.pageX,c.currentComponent.evtY=d.pageY,console.log("mouse move"),!1}}),jmUtils.bindEvent(document,"mouseup",function(b){var c=a;if(c.currentComponent){b=b||event;var d=jmUtils.getElementPosition(c.graph.canvas),e=jmUtils.getEventPosition(b);if(e.pageX>=d.left&&e.pageX<=d.left+c.graph.canvas.width&&e.pageY>=d.top&&e.pageY<=d.top+c.graph.canvas.height){var f=c.currentComponent.img.getAttribute("data-component"),g=c.components[f];"precondition"==g.value&&console.log("hello 1");var h=e.pageX-d.left,i=e.pageY-d.top;g.width&&(h-=g.width/2),g.height&&(i-=g.height/2),"function"==typeof g?g.call(c,{x:h,y:i}):(g=jmUtils.clone(g),g.position={x:h,y:i},c.addCell(g)),c.save(),c.graph.refresh()}return document.body.removeChild(c.currentComponent.img),c.currentComponent=null,!1}if(c.selecting){c.selectRect.visible=!1,c.selecting=!1;var j=c.selectRect.position(),k={x:j.x+c.selectRect.width(),y:j.y+c.selectRect.height()};c.cells.each(function(a,b){var c=b.position?b.position():b.center?b.center():{x:0,y:0};c.x>=Math.min(j.x,k.x)&&c.x<=Math.max(j.x,k.x)&&c.y>=Math.min(j.y,k.y)&&c.y<=Math.max(j.y,k.y)&&b.select(!0)}),c.graph.refresh()}}),this.graph.bind("keydown",function(b){var c=b.keyCode,d=a;switch(c){case 46:if(d.isEnabled()){var e=!1,f=d.getSelectedCells();if(f&&f.length>0&&(d.remove(f),e=!0),d.connects.each(function(a,b){b.selected&&(b.remove(),e=!0)},!0),e)return d.graph.refresh(),d.save(),!1}break;case 97:case 65:if(b.ctrlKey)return d.selectAll(!0),d.emit("select",d,!0),!1;break;case 37:if(d.movable){var f=d.getSelectedCells();return d.moveCells(f,-1,0),!1}break;case 38:if(d.movable){var f=d.getSelectedCells();return d.moveCells(f,0,-1),!1}break;case 39:if(d.movable){var f=d.getSelectedCells();return d.moveCells(f,1,0),!1}break;case 40:if(d.movable){var f=d.getSelectedCells();return d.moveCells(f,0,1),!1}}})},jmEditor.prototype.selectAll=function(a,b){this.cells.each(function(c,d){b&&d.id==b||d.select(a)}),this.connects.each(function(b,c){c.select(1==a)})},jmEditor.prototype.getCell=function(a){return this.cells.get(function(b){return b.id==a})},jmEditor.prototype.getCells=function(){return this.cells.items},jmEditor.prototype.getSelectedCells=function(){var a=[];return this.cells.each(function(b,c){c.selected&&a.push(c)}),a},jmEditor.prototype.getSelectedConnects=function(){var a=[];return this.connects.each(function(b,c){c.selected&&a.push(c)}),a},jmEditor.prototype.moveCells=function(a,b,c){if(jmUtils.isArray(a))for(var d=a.length-1;d>=0;d--)a[d].offset(b,c);else a&&a.offset(b,c);this.graph.refresh()},jmEditor.prototype.remove=function(a){if(jmUtils.isArray(a))for(var b=a.length-1;b>=0;b--)a[b].remove();else a&&a.remove();this.graph.refresh()},jmEditor.prototype.clear=function(){this.remove(this.cells.items)},jmEditor.prototype.regComponent=function(a,b){if(this.components||(this.components=[]),this.components.push(b),"string"==typeof a){var c=document.createElement("img");c.src=a,a=c}a.setAttribute("data-component",this.components.length-1),a.setAttribute("alt",b.value);var d=this;return jmUtils.bindEvent(a,"mousedown",function(a){var b=d;a=a||event;var c=a.target||a.srcElement,e=jmUtils.getElementPosition(c);if(c.getAttribute("data-component")||0==c.children.length&&(c=c.parentElement),b.currentComponent={},b.currentComponent.img=document.createElement("img"),b.currentComponent.img.setAttribute("data-component",c.getAttribute("data-component")),b.currentComponent.img.setAttribute("alt",c.getAttribute("alt")),"IMG"!==c.tagName)for(var f in c.children){var g=c.children[f];if("IMG"===g.tagName){c=g;break}}b.currentComponent.img.src=c.src,b.currentComponent.img.width=c.width,b.currentComponent.img.height=c.height,b.currentComponent.img.style.position="fixed",b.currentComponent.left=e.left,b.currentComponent.top=e.top,console.log("mouse down position: left: "+e.left+"  top:"+e.top),b.currentComponent.img.style.left=e.left+"px",b.currentComponent.img.style.top=e.top+"px",window.document.body.appendChild(b.currentComponent.img);var h=jmUtils.getEventPosition(a||event);return b.currentComponent.evtX=h.pageX,b.currentComponent.evtY=h.pageY,a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,!1}),a},jmEditor.prototype.regStyle=function(a,b){this.styles[a]=b},jmEditor.prototype.save=function(){this.isEnabled()&&(this.caches||(this.caches=[]),this.cacheIndex<this.caches.length-1&&(this.caches=this.caches.slice(0,this.cacheIndex)),this.caches.length>10&&(this.caches=this.caches.slice(this.caches.length-10)),this.caches.push(this.toJSON()),this.cacheIndex=this.caches.length-1)},jmEditor.prototype.undo=function(){if(this.isEnabled()&&this.caches&&this.caches.length>0&&this.cacheIndex>0){"undefined"==typeof this.cacheIndex&&(this.cacheIndex=this.cacheIndex||this.caches.length-1),this.cacheIndex=this.cacheIndex>0?--this.cacheIndex:0;var a=this.caches[this.cacheIndex];this.fromJSON(a,!0)}},jmEditor.prototype.redo=function(){if(this.isEnabled()&&void 0!==this.cacheIndex&&this.cacheIndex<this.caches.length-1&&this.caches&&this.caches.length>0&&(this.cacheIndex=this.cacheIndex+1,this.cacheIndex<this.caches.length)){var a=this.caches[this.cacheIndex];this.fromJSON(a,!0)}},jmEditor.prototype.align=function(a){var b=this.getSelectedCells();if(!(b.length<2)){var c;for(var d in b){var e=b[d],f=e.position();(!c||c.y>f.y)&&(c=e)}switch(a){case"left":for(var d in b){var e=b[d];"left"==a&&e.offset(c.position().x-e.position().x,0,!1)}break;case"right":for(var d in b){var e=b[d],g=c.position().x+c.width();e.offset(g-e.width()-e.position().x,0,!1)}break;case"center":for(var d in b){var e=b[d],h=c.position().y+c.height()/2;e.offset(0,h-e.height()/2-e.position().y,!1)}break;case"top":for(var d in b){var e=b[d];e.offset(0,c.position().y-e.position().y,!1)}break;case"bottom":for(var d in b){var e=b[d],i=c.position().y+c.height();e.offset(0,i-e.height()-e.position().y,!1)}break;case"middle":for(var d in b){var e=b[d],j=c.position().x+c.width()/2;e.offset(j-e.width()/2-e.position().x,0,!1)}}this.save(),this.graph.refresh()}},jmEditor.prototype.resize=function(a){var b=0,c=0;if(a){var d=a.position();b=d.x+a.width(),c=d.y+a.height()}else this.cells.each(function(a,d){var e=d.position(),f=e.x+d.width(),g=e.y+d.height();b=Math.max(f,b),c=Math.max(g,c)});(b>this.graph.canvas.width||c>this.graph.canvas.height)&&this.graph.redraw(Math.max(b,this.graph.canvas.width)+10,Math.max(c,this.graph.canvas.height)+10)},jmEditor.prototype.execute=function(a){switch(a){case"zoomOut":this.graph.zoomOut();break;case"zoomIn":this.graph.zoomIn();break;case"zoomActual":this.graph.zoomActual();break;case"undo":this.undo();break;case"redo":this.redo()}},jmEditor.prototype.toImage=function(){return this.graph.toDataURL()},jmEditor.prototype.toJSON=function(){var a={cells:[],toString:function(){return JSON.stringify(this)}};return this.cells.each(function(b,c){var d={outs:[],preConditions:[],postConditions:[]};if(d.id=c.id,d.position=c.position(),d.width=c.width(),d.height=c.height(),d.style=c.styleName||c.style,d.value=c.value(),c.connects&&c.connects.each(function(a,b){b.from==c&&d.outs.push({id:b.id,to:b.to.id,value:b.value(),from:c.id})}),c.preConditions.length>0)for(var e=c.preConditions.length,b=0;e>b;b++)d.preConditions.push({value:c.preConditions[b].value});if(c.postConditions.length>0)for(var e=c.postConditions.length,b=0;e>b;b++)d.postConditions.push({value:c.postConditions[b].value});a.cells.push(d)}),a},jmEditor.prototype.fromJSON=function(a,b){if(a){if("string"==typeof a&&(a=JSON.parse(a)),this.clear(),a.cells){for(var c in a.cells){var d=a.cells[c];this.addCell(d)}for(var c in a.cells){var d=a.cells[c];if(d.outs){var e=this.getCell(d.id);if(!e)continue;for(var f in d.outs){var g=d.outs[f];if(g.to){var h=this.getCell(g.to);h&&e.connect(h,g.id,g.value)}}}}this.resize(),this.graph.refresh()}b!==!0&&this.save()}};